<!--
Soulframe Tracker â€” Single-file-V.1.2 
Author: Gs_DontFall  
Date: 2025-11-16 | Version: 0.1.2
---------------------Credits:--------------------------
- Puxtril: all Metadata, Warframe-Exporter, and his time.
- Texts/Lore: Avakot.org
- Image references (weapons&Pacts, factions, enemies): Avakot.org
- Game assets & trademarks Â© Digital Extremes Ltd.
----------Fan-made project, not affiliated.------------
-->

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soulframe Tracker</title>

  <!-- Partage social -->
  <meta property="og:title" content="Soulframe Tracker" />
  <meta property="og:description" content="Suivez vos statistiques Soulframe - Armes, capacitÃ©s, ennemis et bien plus encore" />
  <meta property="og:image" content="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/image%20app%20discord.png" />
  <meta property="og:url" content="https://soulframe-tracker.vercel.app" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Soulframe Tracker" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Soulframe Tracker" />
  <meta name="twitter:description" content="Suivez vos statistiques Soulframe" />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/image%20app%20discord.png" />

  <!-- Librairies -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Styles globaux -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;600;700&display=swap');

    body{
      background-image:
        linear-gradient(to bottom right, rgba(13,13,11,.8), rgba(18,18,16,.8), rgba(10,10,8,.8)),
        url('https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/desktop-wallpaper1.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      margin: 0;
      min-height: 100vh;
      font-family: 'Merriweather', serif;
      color-scheme: dark;
    }

    /* Bouton musique */
    .music-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background: transparent !important;
      border: none !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
      width: auto;
      height: auto;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      gap: 6px;
    }

    .music-icon-img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      pointer-events: auto;
      cursor: pointer;
      transition: transform .35s ease, filter .3s ease, opacity .3s ease;
      filter: none;
      opacity: 1;
    }

    .music-control:hover .music-icon-img { transform: scale(1.12); }
    .music-control.muted .music-icon-img { filter: grayscale(35%) brightness(0.9) opacity(0.85); }

    .music-volume-wrapper {
      width: 65px;
    }

    .music-volume-slider {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 999px;
      background: rgba(120, 85, 40, 0.5);
      outline: none;
    }

    .music-volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fbbf24;
      cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.7);
    }

    .music-volume-slider::-moz-range-thumb {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fbbf24;
      cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.7);
      border: none;
    }

    /* Tooltips */
    .relative.group .absolute, .group .absolute { z-index: 99999 !important; }
    table, td, th, .bg-gradient-to-br { position: relative; z-index: 1 !important; }
    .absolute.z-\[9999\] { z-index: 99999 !important; }
    .group:hover .absolute { z-index: 999999 !important; }
    #weapons .overflow-auto { overflow: visible !important; }
    #weapons .group:hover .absolute, #weapons .group .absolute { z-index: 999999 !important; pointer-events: none; }

    #subboss .overflow-auto, #subboss table, #subboss td, #subboss th{
      overflow: visible !important; position: relative !important; z-index: 1 !important;
    }
    #subboss .group:hover .absolute, #subboss .group .absolute{
      z-index: 999999 !important; pointer-events: none;
    }

    /* Lore rotatif */
    @keyframes fadeSwap{
      0%{opacity:0; transform:translateY(6px)}
      12%{opacity:1; transform:translateY(0)}
      88%{opacity:1; transform:translateY(0)}
      100%{opacity:0; transform:translateY(-6px)}
    }
    .lore-anim{ animation: fadeSwap 20s ease-in-out infinite; }
    .lore-panel:hover .lore-anim{ animation-play-state: paused; }
    @media (prefers-reduced-motion: reduce){
      .lore-anim{ animation-duration:.01ms; animation-iteration-count:1; }
    }

    /* Toasts */
    @keyframes fadeInOut{
      0%{opacity:0; transform:translateY(-4px)}
      10%{opacity:1; transform:translateY(0)}
      90%{opacity:1; transform:translateY(0)}
      100%{opacity:0; transform:translateY(-4px)}
    }
    .animate-fade-in-out{ animation: fadeInOut 2.8s ease-in-out; }

    /* Pile de vues */
    .page-stack{ position: relative; min-height: 60vh; }
    .view{ position: static; opacity: 1; transform: none; pointer-events: auto; }
    .view.hidden{ display: none; }

    /* Onglets verticaux */
    .sf-tab {
      position: relative;
      width: 100%;
      display: block;
      padding: 0.55rem 1.4rem;
      margin-bottom: 0.35rem;
      color: #f5e7c5;
      font-size: 12px;
      text-align: left;
      text-transform: none;
      letter-spacing: 0.12em;
      background-color: transparent;
      border: none;
      cursor: pointer;
      outline: none;
      background-image:
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCap.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderExtender.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCap.png");
      background-position: left center, center center, right center;
      background-repeat: no-repeat, repeat-x, no-repeat;
      background-size: auto 100%, auto 100%, auto 100%;
      filter: brightness(0.95);
      transform: translateX(0);
      transition:
        transform 0.12s ease-out,
        filter 0.12s ease-out,
        opacity 0.12s ease-out;
    }

    .sf-tab:hover {
      background-image:
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCapHover.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderExtenderHover.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCapHover.png");
      filter: brightness(1.08);
      transform: translateX(2px);
    }

    .sf-tab.sf-tab-active {
      background-image:
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCapHover.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderExtenderHover.png"),
        url("https://raw.githubusercontent.com/generalshark/app-soulframe-v2/refs/heads/main/Public/BorderEndCapHover.png");
      filter: brightness(1.12);
      transform: translateX(3px);
    }

    .sf-tab-inner {
      display: flex;
      flex-direction: column;
      gap: 2px;
      line-height: 1.2;
      text-shadow: 0 0 4px rgba(0,0,0,0.9);
    }

    .sf-tab-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: rgba(250, 233, 179, 0.95);
    }

    .sf-tab-sub {
      font-size: 11px;
      color: rgba(244, 223, 176, 0.8);
      letter-spacing: 0.03em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 1023px) {
      .sf-tab {
        padding: 0.4rem 1rem;
      }
      .sf-tab-sub {
        font-size: 10px;
      }
    }

    /* Voile de transition */
    .transition-veil{
      position: fixed; inset: 0; z-index: 9999;
      pointer-events: none; display: grid; place-items: center;
      background: rgba(41,28,17,1);
      animation: veilFade 2600ms ease forwards;
      will-change: opacity, transform; backface-visibility: hidden; transform: translateZ(0);
    }

    .transition-veil::after{ content: none !important; }

    .transition-logo{
      width: clamp(120px, 18vw, 220px);
      height: clamp(120px, 18vw, 220px);
      display: grid; place-items: center;
      background: transparent; overflow: visible; isolation: isolate;
      transform: scale(.96);
      animation: logoPop 900ms ease forwards;
    }
    .transition-logo img{
      width: 100%; height: 100%; object-fit: contain;
      image-rendering: auto; filter: none; background: transparent; mix-blend-mode: normal;
    }
    @keyframes veilFade{
      0%{opacity:0; transform:scale(1)}
      12%{opacity:1; transform:scale(1)}
      88%{opacity:1; transform:scale(1)}
      100%{opacity:0; transform:scale(1)}
    }
    @keyframes logoPop{
      0%{opacity:.85; transform:scale(1.96)}
      50%{opacity:1; transform:scale(2)}
      100%{opacity:.95; transform:scale(1.985)}
    }

    /* Zoom images */
    .zoomable-image {
      cursor: zoom-in;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .image-container, 
    .weapon-image-container,
    .enemy-image-container,
    .boss-image-container {
      overflow: visible !important;
      position: relative;
    }

    .image-zoom-tooltip {
      position: fixed;
      z-index: 999999;
      background: #0b0a08;
      border: 2px solid #d4af37;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
      max-width: 320px;
      max-height: 350px;
      pointer-events: none;
      font-family: 'Merriweather', serif;
      backdrop-filter: blur(10px);
    }

    .image-zoom-tooltip img {
      display: block;
      object-fit: contain;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <!-- Audio de fond -->
  <audio id="backgroundMusic" loop aria-hidden="true">
    <source src="https://cdn.jsdelivr.net/gh/generalshark/app-soulframe-v1/docs/TeaserSiteBackGroundLoop.mp3" type="audio/mpeg">
  </audio>

  <!-- Racine React -->
  <div id="root"></div>

  <!-- Bouton musique -->
  <div class="music-control" id="musicControl" title="Musique de fond">
    <img
      class="music-icon-img"
      src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/note_de_music_aura.png"
      alt="Music"
    />
    <div class="music-volume-wrapper">
      <input
        id="musicVolume"
        type="range"
        min="0"
        max="100"
        step="1"
        class="music-volume-slider"
      />
    </div>
  </div>

  <!-- App React -->
  <script type="text/babel">
    // Gestion musique
    const backgroundMusic = document.getElementById('backgroundMusic');
    const musicControl = document.getElementById('musicControl');
    let isMusicPlaying = false;
    let musicStarted = false;

    const startBackgroundMusic = () => {
      if (backgroundMusic && !musicStarted) {
        let stored = 0.2;
        try {
          const saved = localStorage.getItem('soulframe_volume');
          if (saved) {
            const v = parseFloat(saved);
            if (Number.isFinite(v) && v >= 0 && v <= 1) stored = v;
          }
        } catch (e) {}

        backgroundMusic.volume = stored;

        backgroundMusic.play().then(() => {
          isMusicPlaying = true; musicStarted = true;
          musicControl.classList.remove('muted');
          musicControl.setAttribute('aria-pressed', 'true');
        }).catch(() => {});
      }
    };

    const toggleMusic = () => {
      if (!backgroundMusic) return;
      if (isMusicPlaying) {
        backgroundMusic.pause();
        musicControl.classList.add('muted');
        musicControl.setAttribute('aria-pressed', 'false');
      } else {
        backgroundMusic.play();
        musicControl.classList.remove('muted');
        musicControl.setAttribute('aria-pressed', 'true');
      }
      isMusicPlaying = !isMusicPlaying;
    };

    const musicIcon = document.querySelector('#musicControl .music-icon-img');
    if (musicIcon) {
      musicIcon.addEventListener('click', toggleMusic);
    }

    window.addEventListener('load', () => setTimeout(startBackgroundMusic, 1000));
    backgroundMusic.addEventListener('ended', () => {
      backgroundMusic.currentTime = 0;
      backgroundMusic.play();
    });
    backgroundMusic.addEventListener('error', () => {
      musicControl.style.display = 'none';
    });

    // Hooks React
    const { useState, useEffect, useMemo, useRef } = React;

    // Composants
    const Card = ({ id, title, children, className = "", defaultExpanded = true }) => {
      const [isExpanded, setIsExpanded] = useState(defaultExpanded);
      const contentRef = useRef(null);

      return (
        <section id={id} className="scroll-mt-24">
          <div className={`
            relative
            bg-[#0b0a08]/90
            border border-amber-700/70
            rounded-2xl
            shadow-[0_0_22px_rgba(0,0,0,0.85)]
            p-6 mb-8
            backdrop-blur-sm
            transition-all duration-300
            hover:shadow-amber-900/30
            hover:border-amber-500/80
            ${className}
          `}>
            <div className="absolute inset-1 rounded-2xl border border-amber-400/70 pointer-events-none" />
            <div className="relative z-10">
              <h2
                className="
                  text-2xl font-serif text-amber-300 drop-shadow mb-4
                  border-b border-amber-800/40 pb-2
                  flex items-center justify-between
                  cursor-pointer
                  hover:bg-amber-900/10
                  px-2 -mx-2 rounded-lg
                  transition-colors
                "
                onClick={() => setIsExpanded(v => !v)}
              >
                <span className="bg-gradient-to-r from-amber-400 to-amber-300 bg-clip-text text-transparent flex items-center gap-2">
                  {title}
                </span>
                <span
                  className="
                    text-amber-400/70 text-xl font-bold
                    w-6 h-6 flex items-center justify-center
                    bg-amber-900/30 rounded
                  "
                  aria-hidden="true"
                >
                  {isExpanded ? "âˆ’" : "+"}
                </span>
              </h2>

              <div
                ref={contentRef}
                className={`
                  transition-all duration-500 ease-in-out
                  ${isExpanded ? "max-h-[5000px] opacity-100" : "max-h-0 opacity-0 overflow-hidden"}
                `}
              >
                {children}
              </div>
            </div>
          </div>
        </section>
      );
    };

    const MiniStatCard = ({ label, value, icon, highlight = false, badgeLabel }) => (
      <div className="
        relative
        bg-[#0b0a08]/90
        border border-amber-700/70
        rounded-xl
        shadow-[0_0_18px_rgba(0,0,0,0.8)]
        px-5 py-4
        flex items-center gap-3
      ">
        <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
        <div className="relative z-10 flex items-center gap-3">
          <div className="w-7 h-7 flex items-center justify-center flex-shrink-0">
            {typeof icon === "string" ? <span className="text-xl">{icon}</span> : icon}
          </div>
          <div className="leading-tight">
            <div className="text-[11px] tracking-[0.16em] uppercase text-amber-300/80">
              {label}
            </div>
            <div className={`
              text-lg font-bold mt-1
              ${highlight ? "text-emerald-400" : "text-amber-50"}
            `}>
              {value}
              <DeltaBadge label={badgeLabel} />
            </div>
          </div>
        </div>
      </div>
    );

    const DeltaBadge = ({ label }) => {
      if (!label) return null;
      return (
        <span className="
          ml-1 text-[11px]
          px-1.5 py-0.5
          rounded-full
          bg-emerald-900/40
          text-emerald-300
          border border-emerald-600/60
          align-middle
        ">
          {label}
        </span>
      );
    };

    const DataTable = ({
      headers,
      data,
      className = "",
      isBoss = false,
      sortConfig,
      onSortChange
    }) => (
      <div className={`
        overflow-x-auto
        rounded-xl border
        ${isBoss ? "border-amber-600/30" : "border-amber-800/40"}
        shadow-inner
        ${className}
      `}>
        <table className="min-w-full text-sm">
          <thead className={`
            ${isBoss
              ? "bg-gradient-to-r from-[#2a1a0a] to-[#3a2a15]"
              : "bg-gradient-to-r from-[#1a1814] to-[#1f1d18]"
            }
            text-amber-300
            sticky
            top-0
            z-20
          `}>
            <tr>
              {headers.map((h, i) => {
                const label = typeof h === "string" ? h : h.label;
                const key = typeof h === "string" ? null : h.key;
                const isSortable = !!(onSortChange && key);
                const isActive = isSortable && sortConfig && sortConfig.key === key;
                const direction = isActive ? sortConfig.direction : null;

                return (
                  <th
                    key={label}
                    scope="col"
                    onClick={() => isSortable && onSortChange(key)}
                    className={`
                      px-4 py-3 text-left font-semibold
                      ${i === 0 ? "rounded-tl-xl" : ""}
                      ${i === headers.length - 1 ? "rounded-tr-xl" : ""}
                      ${isSortable
                        ? "cursor-pointer select-none hover:bg-amber-900/40"
                        : ""
                      }
                    `}
                  >
                    <div className="flex items-center gap-1">
                      <span>{label}</span>
                      {isActive && (
                        <span className="text-[10px] text-amber-400">
                          {direction === "asc" ? "â–²" : "â–¼"}
                        </span>
                      )}
                    </div>
                  </th>
                );
              })}
            </tr>
          </thead>
          <tbody>
            {data.map((row, i) => (
              <tr
                key={i}
                className={
                  i % 2
                    ? "bg-[#12110f]/50 hover:bg-amber-900/10"
                    : "bg-[#181714]/30 hover:bg-amber-900/10"
                }
              >
                {row.map((cell, j) => (
                  <td
                    key={j}
                    className="px-4 py-3 text-amber-100 border-t border-amber-800/20"
                  >
                    {cell}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    );

    const AccordionSection = ({ title, subtitle, isOpen, onToggle, children }) => (
      <div className="
        relative
        bg-[#0b0a08]/90
        border border-amber-700/70
        rounded-xl
        shadow-[0_0_18px_rgba(0,0,0,0.8)]
        overflow-hidden
      ">
        <button
          type="button"
          onClick={onToggle}
          className="
            w-full
            flex items-center justify-between
            px-4 py-3
            text-left
            bg-amber-900/20
            hover:bg-amber-900/35
            transition-colors
          "
        >
          <div>
            <div className="text-sm font-semibold text-amber-200 flex items-center gap-2">
              {title}
            </div>
            {subtitle && (
              <div className="text-xs text-amber-400/80 mt-0.5">
                {subtitle}
              </div>
            )}
          </div>
          <span className="
            text-amber-300/80 text-xl font-bold
            w-6 h-6 flex items-center justify-center
            bg-amber-900/40 rounded
          ">
            {isOpen ? "âˆ’" : "+"}
          </span>
        </button>
        <div className={`
          transition-all duration-500 ease-in-out
          ${isOpen ? "max-h-[5000px] opacity-100" : "max-h-0 opacity-0 overflow-hidden"}
        `}>
          <div className="p-4">
            {children}
          </div>
        </div>
      </div>
    );

    // Constantes
    const PROXY = "https://api.codetabs.com/v1/proxy?quest=";
    const SOULFRAME_API = "https://api.soulframe.com/cdn/getProfileViewingData.php?playerId=";
    const LORE_URL = "https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/docs/lore.json";

    const ongletsConfig = [
      { id: 'player',    label: 'Player' },
      { id: 'boss',      label: 'Boss' },
      { id: 'enemies',   label: 'Enemies' },
      { id: 'weapons',   label: 'Weapons' },
      { id: 'abilities', label: 'Abilities' }
    ];

    const ABILITY_LABELS = {
      FeyBloodLustAbility: { name: "Fellust", group: "Tethren", icon: "https://static.wikitide.net/soulframewiki/7/7a/BloodlustNoBacker.png" },
      FeyRageAbility: { name: "Call of the Ancients", group: "Tethren", icon: "https://static.wikitide.net/soulframewiki/b/ba/RageNoBacker.png" },
      FeyStompAbility: { name: "Clash", group: "Tethren", icon: "https://static.wikitide.net/soulframewiki/e/e2/SteadyFeetNoBacker.png" },
      FeyBlindAbility: { name: "Picktrix Powder", group: "Sirin", icon: "https://static.wikitide.net/soulframewiki/f/f2/PocketSandNoBacker.png" },
      FeyDecoyAbility: { name: "Trick of the Light", group: "Sirin", icon: "https://static.wikitide.net/soulframewiki/9/98/DecoyNoBacker.png" },
      FeyInvisibleAbility: { name: "Glamour", group: "Sirin", icon: "https://static.wikitide.net/soulframewiki/1/10/InvisibilityNoBacker.png" },
      FeyWardStoneAbility: { name: "Bestone", group: "Oscelda", icon: "https://static.wikitide.net/soulframewiki/b/b6/TurnToStoneNoBacker.png" },
      FeyHealthTotemAbility: { name: "Elderbloom", group: "Oscelda", icon: "https://static.wikitide.net/soulframewiki/1/13/HealingWardNoBacker.png" },
      FeyWardFlockAbility: { name: "Phantom Flock", group: "Oscelda", icon: "https://static.wikitide.net/soulframewiki/0/0b/RazorFlockNoBacker.png" },
      OdeWaveAbility: { name: "Seismor", group: "Ode Tempest", icon: "https://static.wikitide.net/soulframewiki/6/68/ShockwaveNoBacker.png" },
      OdeShockAbility: { name: "Astra Sphere", group: "Ode Tempest", icon: "https://static.wikitide.net/soulframewiki/8/87/ShockBallNoBacker.png" },
      OdeShieldAbility: { name: "Atmos Sphere", group: "Ode Tempest", icon: "https://static.wikitide.net/soulframewiki/b/b9/PersonalShieldNoBacker.png" },
      FireRainAbility: { name: "Ignus Wroth", group: "Mora's Hand", icon: "https://static.wikitide.net/soulframewiki/b/b4/FieryFissureNoBacker.png" },
      BlazeArmourAbility: { name: "Ember", group: "Mora's Hand", icon: "https://static.wikitide.net/soulframewiki/2/26/BlazingArmorNoBacker.png" },
      FirePushAbility: { name: "Inferno", group: "Mora's Hand", icon: "https://static.wikitide.net/soulframewiki/4/49/PyroBlastNoBacker.png" },
      BromiusSlamAbility: { name: "Rump Thump", group: "Bromius", icon: "https://static.wikitide.net/soulframewiki/7/70/CannonBallNoBacker.png" },
      BromiusRootAbility: { name: "Wevetroot", group: "Bromius", icon: "https://static.wikitide.net/soulframewiki/1/1c/RootSpikeNoBacker.png" },
      BromiusArmourAbility: { name: "Song of Growth", group: "Bromius", icon: "https://static.wikitide.net/soulframewiki/c/c3/ArmourPlatingNoBacker.png" },
      GarrenSapAbility: { name: "Torment", group: "Garren Rood", icon: "https://static.wikitide.net/soulframewiki/d/d2/SapNoBacker.png" },
      GarrenLightAbility: { name: "Behest", group: "Garren Rood", icon: "https://static.wikitide.net/soulframewiki/6/69/BlindingLightNoBacker.png" },
      StagStampedeAbility: { name: "Stampede", group: "Garren Rood", icon: "https://static.wikitide.net/soulframewiki/0/0a/StampedeNoBacker.png" },
      WolfAbility: { name: "Werewalker", group: "Orengall", icon: "https://static.wikitide.net/soulframewiki/8/83/BecomeWolf.png" },
      WolfPackAbility: { name: "Packhunter", group: "Orengall", icon: "https://static.wikitide.net/soulframewiki/c/cf/WhiteNoBacker-WolfPack.png" },
      WolfHowlAbility: { name: "Howl", group: "Orengall", icon: "https://static.wikitide.net/soulframewiki/a/a2/WhiteNoBacker-WolfHowl.png" },
      FeyBowAbility: { name: "FeyBow", group: "IndÃ©fini", icon: "ðŸ¹" },
      FeyPauseAbility: { name: "FeyPause", group: "IndÃ©fini", icon: "â¸ï¸" }
    };

    const GROUP_ORDER = ["Tethren","Sirin","Oscelda","Ode Tempest","Mora's Hand","Bromius","Garren Rood","Orengall","IndÃ©fini"];
    const PACT_ICONS = {
      "Bromius":"https://static.wikitide.net/soulframewiki/1/13/BromiusPact.png",
      "Garren Rood":"https://static.wikitide.net/soulframewiki/5/5e/Pacts-Garren.png",
      "Mora's Hand":"https://static.wikitide.net/soulframewiki/e/ef/Pacts-FennJotar.png",
      "Ode Tempest":"https://static.wikitide.net/soulframewiki/a/aa/Pacts-Ode.png",
      "Orengall":"https://static.wikitide.net/soulframewiki/9/9c/Pacts-Orengal.png",
      "Oscelda":"https://static.wikitide.net/soulframewiki/b/bf/Oscelda.png",
      "Sirin":"https://static.wikitide.net/soulframewiki/d/dc/Sirin.png",
      "Tethren":"https://static.wikitide.net/soulframewiki/1/1c/Tethren.png"
    };

    const WEAPON_NAMES = {
      "BromiusCleaverMeleeWeapon": { name: "Marrow's Bane", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/4/40/MarrowsBane.png" },
      "SphereSwordMeleeWeapon": { name: "Sollos-I", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/e/e3/SollosI.png" },
      "StarterSwordMeleeWeapon": { name: "Wulder", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/f/fb/Wulder.png" },
      "FennJotarSwordMeleeWeapon": { name: "IgneMora", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/e/eb/IgneMora.png" },
      "DendritSwordMeleeWeapon": { name: "Vetch", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/3/39/Vetch.png" },
      "MockeryTurashMeleeWeapon": { name: "Nurash", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/5/5f/Nurash.png" },
      "MockeryStultionMeleeWeapon": { name: "Stultin", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/7/76/Stultin.png" },
      "MockeryBrazardMeleeWeapon": { name: "Tessard", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/4/4f/Tessard.png" },
      "FeySwordMeleeWeapon": { name: "Dewelion", category: "main", group: "Long Blade", icon: "https://static.wikitide.net/soulframewiki/f/fb/Dewelion.png" },
      "SphereDualSwordsMeleeWeapon": { name: "Rivt-II", category: "main", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/2/2b/RivtII.png" },
      "GarrenSwordMeleeWeapon": { name: "The Royal Tines", category: "main", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/6/68/TheRoyalTines.png" },
      "SinecureDualDaggersMeleeWeapon": { name: "Unsula", category: "main", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/b/b7/Unsula.png" },
      "SpherePolearmMeleeWeapon": { name: "Vasp-IV", category: "main", group: "Polearm", icon: "https://static.wikitide.net/soulframewiki/c/c0/VaspIV.png" },
      "GarrenPolearmMeleeWeapon": { name: "Gathannan", category: "main", group: "Polearm", icon: "https://static.wikitide.net/soulframewiki/5/51/Gathannan.png" },
      "DeoraPolearmMeleeWeapon": { name: "Rook", category: "main", group: "Polearm", icon: "https://static.wikitide.net/soulframewiki/1/1b/Rook.png" },
      "CleansedSpearMeleeWeapon": { name: "Duhk Halic", category: "main", group: "Polearm", icon: "https://static.wikitide.net/soulframewiki/0/06/DuhkHalic.png" },
      "StarterStaffCasterRangedMeleeWeapon": { name: "Gwylen", category: "main", group: "Magick", icon: "https://static.wikitide.net/soulframewiki/5/53/Gwylen.png" },
      "WazzardStaffCasterRangedMeleeWeapon": { name: "The Erstroot", category: "main", group: "Magick", icon: "https://static.wikitide.net/soulframewiki/8/84/TheErstroot.png" },
      "OdeCastingDeviceRangedMeleeWeapon": { name: "Odiac", category: "main", group: "Magick", icon: "https://static.wikitide.net/soulframewiki/3/30/Odiac.png" },
      "StarterBowRangedMeleeWeapon": { name: "Thistle", category: "main", group: "Bow", icon: "https://static.wikitide.net/soulframewiki/1/1a/Thistle.png" },
      "OdeBowRangedMeleeWeapon": { name: "Blitzel", category: "main", group: "Bow", icon: "https://static.wikitide.net/soulframewiki/6/63/Blitzel.png" },
      "GrandFatherBowRangedMeleeWeapon": { name: "Juniper", category: "main", group: "Bow", icon: "https://static.wikitide.net/soulframewiki/9/9a/Juniper.png" },
      "DendritSwordAndBoardMeleeWeapon": { name: "Bog & Myrtle", category: "main", group: "Shield", icon: "https://static.wikitide.net/soulframewiki/7/77/BogandMyrtle.png" },
      "SphereSwordAndBoardMeleeWeapon": { name: "Oryn Umbr", category: "main", group: "Shield", icon: "https://static.wikitide.net/soulframewiki/5/57/OrynUmbr.png" },
      "SecondaryDaggerMeleeWeapon": { name: "Nettle", category: "secondary", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/4/40/Nettle.png" },
      "SecondaryDendritDaggerMeleeWeapon": { name: "Virdigris", category: "secondary", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/0/0b/Virdigris.png" },
      "SecondaryFeyDaggerMeleeWeapon": { name: "Witan", category: "secondary", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/a/a1/Witan.png" },
      "SecondaryOdeSawDaggerMeleeWeapon": { name: "Grinn", category: "secondary", group: "Short Blade", icon: "https://static.wikitide.net/soulframewiki/c/c7/Grinn.png" },
      "SecondaryStarterThrowingKnivesRangedMeleeWeapon": { name: "Precklies", category: "secondary", group: "Flyblade", icon: "https://static.wikitide.net/soulframewiki/b/b5/Precklies.png" },
      "SecondaryThrowingKnivesRangedMeleeWeapon": { name: "SkÃ­lter", category: "secondary", group: "Flyblade", icon: "https://static.wikitide.net/soulframewiki/3/3e/Skilter.png" }
    };

    const SUBBOSS_CATEGORY = {
      name: "SubBoss",
      enemies: [
        "SpiderSubBossAvatar","NimrodSubBossAvatar","MendicantWazzardSubBossAvatar",
        "MockeryArmoredManSubBossAvatar","MendicantKnightBellCleaverSubBossAvatar",
        "MeleeGreatSwordSubBossAvatar","CorruptedSproutFolkSubBossAvatar",
        "RangedHunterSubBossAvatar","MeleeMaceOfficerSubBossAvatar","MendicantKingAvatar"
      ],
      labels: {
        SpiderSubBossAvatar:{ name:"Etheldred the Weaver", icon:"https://static.wikitide.net/soulframewiki/1/16/EtheldredTheWeaver.png" },
        NimrodSubBossAvatar:{ name:"Discharged Nimrod", icon:"https://static.wikitide.net/soulframewiki/c/cb/DischargedNimrod.jpg" },
        MendicantWazzardSubBossAvatar:{ name:"Wraith of Wastes", icon:"https://static.wikitide.net/soulframewiki/0/0b/WraithofWastes.jpg" },
        MockeryArmoredManSubBossAvatar:{ name:"Thrice-Bound Impidh", icon:"https://static.wikitide.net/soulframewiki/5/52/ThriceboundImpidh.jpg" },
        MendicantKnightBellCleaverSubBossAvatar:{ name:"Knell Knight", icon:"https://static.wikitide.net/soulframewiki/f/fe/KnellKnight.jpg" },
        MeleeGreatSwordSubBossAvatar:{ name:"Castellan Malrog", icon:"https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/Castellan%20Malrog.PNG" },
        CorruptedSproutFolkSubBossAvatar:{ name:"Kabocha", icon:"https://static.wikitide.net/soulframewiki/0/07/Kabocha.jpg" },
        RangedHunterSubBossAvatar:{ name:"Gruul Seeker Ruthos", icon:"https://static.wikitide.net/soulframewiki/0/02/GruulSeekerRuthos.jpg" },
        MeleeMaceOfficerSubBossAvatar:{ name:"Sinecure-errant Gawth", icon:"https://static.wikitide.net/soulframewiki/1/1e/SinecureerrantGawth.jpg" },
        MendicantKingAvatar:{ name:"Mendicant King", icon:"https://static.wikitide.net/soulframewiki/6/67/MendicantKingSquare.png" }
      }
    };

    const ENEMY_CATEGORIES = {
      GRUNTS:{ name:"Grunt Standards", enemies:[
        "MeleeGruntAvatar","DualMeleeGruntAvatar","MeleeGruntShieldAvatar","MeleeGruntNightAvatar",
        "MeleeAxeGruntGladesAvatar","MeleeSpikedMaceGruntGladesAvatar","MeleeDualAxeGruntGladesAvatar",
        "MeleeLongSwordGruntGladesAvatar","CorruptedSproutFolkGruntAvatar","CorruptedSproutFolkSpearGruntAvatar",
        "UCGruntAvatar","UCDualGruntAvatar"
      ]},
      ELITES:{ name:"Ã‰lites", enemies:[
        "EliteMeleeGruntAvatar","MeleeGruntShieldEliteAvatar","DualMeleeGruntEliteAvatar",
        "EliteUCGruntAvatar","RangedHunterEliteAvatar","OdeCasterEliteAvatar","SpiderEliteAvatar"
      ]},
      RANGED:{ name:"Tireurs", enemies:["RangedHunterAvatar","RangedHunterGladesDaggerAvatar"]},
      OFFICERS:{ name:"Officiers", enemies:["MeleeSwordOfficerAvatar","MeleeMaceOfficerAvatar"]},
      ODE_TEMPEST:{ name:"Ode Tempest", enemies:["OdeCasterAvatar","OdeAttackDogAvatar"]},
      MENDICANT:{ name:"Mendicants", enemies:[
        "MendicantThrallAvatar","MendicantKnightAvatar","MendicantWazzardKnightAvatar",
        "MendicantCasterAvatar","MendicantWazzardAvatar"
      ]},
      SPECTRE:{ name:"Spectres", enemies:[
        "WanderingGhostSoldierAvatar","WanderingGhostKnightAvatar","WorldCircadeGhostKnightAvatar",
        "CircadeGhostKnightAvatar","HallowSpiritBaseAvatar","CryptSpiritBaseAvatar",
        "AvarotHallowSpiritAvatar","TalHallowSpiritAvatar"
      ]},
      CORRUPTED:{ name:"Corrompus", enemies:["CorruptedSproutFolkAvatar","CorruptedBromiusAvatar","GarrenHerdBaseAvatar"]},
      BOSSES:{ name:"Boss & Uniques", enemies:[
        "NimrodAvatar",
      ]},
      OTHER:{ name:"Divers", enemies:[]}
    };

    const ENEMY_COMPENDIUM = {
      "MendicantCasterAvatar":{ name:"Mendicant Caster", faction:"Mendicant", biome:"Midrath", type:"Caster" },
      "MendicantKnightAvatar":{ name:"Mendicant Knight", faction:"Mendicant", biome:"Midrath", type:"Elite" },
      "MendicantThrallAvatar":{ name:"Mendicant Thrall", faction:"Mendicant", biome:"Midrath", type:"Grunt" },
      "MendicantWazzardAvatar":{ name:"Mendicant Wazzard", faction:"Mendicant", biome:"Midrath", type:"Caster" },
      "MendicantWazzardKnightAvatar":{ name:"Mendicant Wazzard Knight", faction:"Mendicant", biome:"Midrath", type:"Elite" },
      "MeleeGruntMessengerAvatar": {name: "Melee Grunt Messenger",faction: "Ode",biome: "Midrath",type: "Grunt"},
      "MeleeGruntAvatar":{ name:"Mendicant Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "DualMeleeGruntAvatar":{ name:"Dual Wielder", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "EliteMeleeGruntAvatar":{ name:"Elite Grunt", faction:"Ode", biome:"Midrath", type:"Elite" },
      "RangedHunterAvatar":{ name:"Ranged Hunter", faction:"Ode", biome:"Midrath", type:"Ranged" },
      "RangedHunterEliteAvatar":{ name:"Elite Ranged Hunter", faction:"Ode", biome:"Midrath", type:"Elite" },
      "OdeAttackDogAvatar":{ name:"Ode Dog", faction:"Ode", biome:"Midrath", type:"Beast" },
      "OdeCasterAvatar":{ name:"Ode Caster", faction:"Ode", biome:"Midrath", type:"Caster" },
      "OdeCasterEliteAvatar":{ name:"Ode Caster Elite", faction:"Ode", biome:"Midrath", type:"Elite" },
      "SiegeEngineTaleAvatar":{ name:"Ode'n Bisulcam", faction:"Ode", biome:"Midrath", type:"Siege" },
      "MeleeMaceAvatar":{ name:"Ode Mace Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeSwordAvatar":{ name:"Ode Sword Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "RangedHunterGladesDaggerAvatar":{ name:"Ranged Hunter", faction:"Ode", biome:"Midrath", type:"Ranged" },
      "MeleeDaggerAndShieldAvatar":{ name:"Ode Dagger Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeAxeAvatar":{ name:"Capitaine Greataxe", faction:"Ode", biome:"Midrath", type:"Officer" },
      "MeleeSwordOfficerAvatar":{ name:"Ode Sword Officer", faction:"Ode", biome:"Midrath", type:"Officer" },
      "MeleeMaceOfficerAvatar":{ name:"Ode Mace Officer", faction:"Ode", biome:"Midrath", type:"Officer" },
      "NimrodAvatar":{ name:"Discharged Nimrod", faction:"Ode", biome:"Midrath", type:"Boss" },
      "WazzardSpiderAvatar":{ name:"Wazzard Weaver", faction:"Corrupted", biome:"Midrath", type:"Caster" },
      "GarrenHerdBaseAvatar":{ name:"Vadagar Stag", faction:"Corrupted", biome:"Midrath", type:"Boss" },
      "CorruptedSlugAvatar":{ name:"Corrupted Slug", faction:"Corrupted", biome:"Midrath", type:"Beast" },
      "CorruptedSproutFolkAvatar":{ name:"Corrupted Sprout", faction:"Corrupted", biome:"Midrath", type:"Grunt" },
      "CorruptedSproutFolkGruntAvatar":{ name:"Avakot corrompu", faction:"Corrupted", biome:"Midrath", type:"Grunt" },
      "CorruptedSproutFolkSpearGruntAvatar":{ name:"Corrupted Spear Grunt", faction:"Corrupted", biome:"Midrath", type:"Grunt" },
      "BaliqShrimpAvatar":{ name:"Baliq Shrimp", faction:"Corrupted", biome:"Midrath", type:"Beast" },
      "BaliqShrimpGladesAvatar":{ name:"Baliq Shrimp", faction:"Corrupted", biome:"Midrath", type:"Beast" },
      "MockeryArmoredManAvatar":{ name:"Mockery Armored", faction:"Mockery", biome:"Midrath", type:"Grunt" },
      "MockeryManAvatar":{ name:"Mockery", faction:"Mockery", biome:"Midrath", type:"Grunt" },
      "AvarotHallowSpiritAvatar":{ name:"Avarot Hallow Spirit", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "HallowSpiritBaseAvatar":{ name:"Hallow Spirit", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "TalHallowSpiritAvatar":{ name:"Tal Hallow Spirit", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "CryptSpiritBaseAvatar":{ name:"Crypt Spirit", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "MeleeDualAxeGruntGladesAvatar":{ name:"Dual Axe Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "SquidplantAvatar":{ name:"Will-o-wing", faction:"Hazards", biome:"Midrath", type:"Hazard" },
      "SquidplantChildAvatar":{ name:"Child Will-o-wing", faction:"Hazards", biome:"Midrath", type:"Hazard" },
      "MeleeGruntShieldAvatar":{ name:"Shield Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeGruntNightAvatar":{ name:"Night Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeAxeGruntGladesAvatar":{ name:"Axe Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeSpikedMaceGruntGladesAvatar":{ name:"Spiked Mace Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeLongSwordGruntGladesAvatar":{ name:"Long Sword Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "UCGruntAvatar":{ name:"UC Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "UCDualGruntAvatar":{ name:"UC Dual Grunt", faction:"Ode", biome:"Midrath", type:"Grunt" },
      "MeleeGruntShieldEliteAvatar":{ name:"Shield Elite", faction:"Ode", biome:"Midrath", type:"Elite" },
      "DualMeleeGruntEliteAvatar":{ name:"Dual Wielder Elite", faction:"Ode", biome:"Midrath", type:"Elite" },
      "EliteUCGruntAvatar":{ name:"UC Elite", faction:"Ode", biome:"Midrath", type:"Elite" },
      "WanderingGhostSoldierAvatar":{ name:"Wandering Ghost Soldier", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "WanderingGhostKnightAvatar":{ name:"Wandering Ghost Knight", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "WorldCircadeGhostKnightAvatar":{ name:"World Circade Ghost Knight", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "CircadeGhostKnightAvatar":{ name:"Circade Ghost Knight", faction:"Spectres", biome:"Midrath", type:"Spirit" },
      "MeleeGreatSwordSubBossAvatar":{ name:"Castellan Malrog", faction:"Ode", biome:"Midrath", type:"SubBoss" },
      "SpiderAvatar":{ name:"Weaver (Spider)", faction:"Corrupted", biome:"Midrath", type:"Beast" },
      "SpiderEliteAvatar":{ name:"Weaver Elite", faction:"Corrupted", biome:"Midrath", type:"Elite" },
      "MendicantWazzardSubBossAvatar":{ name:"Wraith of Wastes", faction:"Mendicant", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/0/0b/WraithofWastes.jpg" },
      "NimrodSubBossAvatar": { name:"Discharged Nimrod", faction:"Ode", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/c/cb/DischargedNimrod.jpg" },
      "SpiderSubBossAvatar":{ name:"Etheldred the Weaver", faction:"Corrupted", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/1/16/EtheldredTheWeaver.png" },
      "MockeryArmoredManSubBossAvatar":{ name:"Thrice-Bound Impidh", faction:"Mockery", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/5/52/ThriceboundImpidh.jpg" },
      "MendicantKnightBellCleaverSubBossAvatar": { name:"Knell Knight", faction:"Mendicant", biome:"Midrath", type:"Agari" },
      "MeleeMaceOfficerSubBossAvatar": { name:"Sinecure-errant Gawth", faction:"Ode", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/1/1e/SinecureerrantGawth.jpg" },
      "RangedHunterSubBossAvatar": { name:"Gruul Seeker Ruthos", faction:"Ode", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/0/02/GruulSeekerRuthos.jpg" },
      "MendicantKingAvatar":{ name:"Mendicant King", faction:"Mendicant", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/6/67/MendicantKingSquare.png" },
      "CorruptedSproutFolkSubBossAvatar":{ name:"Kabocha", faction:"Corrupted", biome:"Midrath", type:"Agari", icon:"https://static.wikitide.net/soulframewiki/0/07/Kabocha.jpg" },
      "MeleeGreatSwordSubBossAvatar":{ name:"Castellan Malrog", faction: "Ode", biome:"Midrath", type:"Enemie", icon:"https://static.wikitide.net/soulframewiki/thumb/6/6f/Castellan_Malrog.jpg/800px-Castellan_Malrog.jpg" }
    };

    const ENEMY_FACTION = {
      MendicantCaster: "Mendicant",
      MendicantKing: "Mendicant",
      MendicantKnight: "Mendicant",
      MendicantKnightBellCleaverSubBoss: "Mendicant",
      MendicantThrall: "Mendicant",
      MendicantWazzard: "Mendicant",
      MendicantWazzardKnight: "Mendicant",
      MendicantWazzardSubBoss: "Mendicant",
      SpiderElite: "Corrupted",
      OdeAttackDog: "Ode",
      OdeCaster: "Ode",
      OdeCasterElite: "Ode",
      SiegeEngineTale: "Ode",
      MeleeMace: "Ode",
      MeleeSword: "Ode",
      RangedHunterGladesDagger: "Ode",
      MeleeDaggerAndShield: "Ode",
      MeleeAxe: "Ode",
      MeleeSwordOfficer: "Ode",
      MeleeMaceOfficer: "Ode",
      Nimrod: "Ode",
      CorruptedSlug: "Corrupted",
      CorruptedSproutFolk: "Corrupted",
      CorruptedSproutFolkGrunt: "Corrupted",
      CorruptedSproutFolkSpearGrunt: "Corrupted",
      CorruptedSproutFolkSubBoss: "Corrupted",
      CorruptedBromius: "Corrupted",
      BaliqShrimp: "Corrupted",
      BaliqShrimpGlades: "Corrupted",
      MockeryArmoredMan: "Mockery",
      MockeryArmoredManSubBoss: "Mockery",
      MockeryMan: "Mockery",
      AvarotHallowSpirit: "Spectres",
      HallowSpiritBase: "Spectres",
      TalHallowSpirit: "Spectres",
      CryptSpiritBase: "Spectres",
      MeleeDualAxeGruntGlades: "Ode",
      Squidplant: "Hazards",
      SquidplantChild: "Hazards"
    };

    const ENEMY_DUNGEON = {
      EliteUCGrunt: "Undercity",
      UCDualGrunt: "Undercity",
      UCGrunt: "Undercity",
      CircadeGhostKnight: "Crypt of the Circade",
      WorldCircadeGhostKnight: "Crypt of the Circade",
      CryptSpiritBase: "Crypt of the Circade"
    };

    const ENEMY_EVENT = {
      AvarotHallowSpirit: "Halloween",
      HallowSpiritBase: "Halloween",
      TalHallowSpirit: "Halloween"
    };

    const ENEMY_SPECTRES = [
      "AvarotHallowSpirit",
      "HallowSpiritBase",
      "TalHallowSpirit",
      "CryptSpiritBase"
    ];

    const ENEMY_RENAMES = {
      MockeryMan: "Mockery",
      MockeryArmoredMan: "Mockery Armored",
      CryptSpiritBase: "Crypt Spirit",
      HallowSpiritBase: "Hallow Spirit",
      MeleeMaceOfficerSubBoss: "Sinecure-errant Gawth",
      MeleeGreatSwordSubBoss: "Castellan Malrog",
      MendicantKnightBellCleaverSubBoss: "The Circade Ghost",
      Spider: "Weaver (Spider)",
      SpiderElite: "Weaver Elite",
      OdeAttackDog: "Ode Dog",
      SiegeEngineTale: "Ode'n Bisulcam",
      DualMeleeGrunt: "Dual Wielder",
      BaliqShrimp: "Baliq Shrimp",
      BaliqShrimpGlades: "Baliq Shrimp",
      Squidplant: "Will-o-wing",
      SquidplantChild: "Child Will-o-wing",
      CorruptedSproutFolkGrunt: "Avakot corrompu",
      GarrenHerdBase: "Vadagar Stag",
      MeleeAxe: "Capitaine Greataxe"
    };

    const COMPENDIUM_EXCLUDED = new Set([
      "MendicantWazzardSubBoss",
      "NimrodSubBoss",
      "SpiderSubBoss",
      "MockeryArmoredManSubBoss",
      "MendicantKnightBellCleaverSubBoss",
      "MeleeMaceOfficerSubBoss",
      "RangedHunterSubBoss",
      "MendicantKing",
      "CorruptedSproutFolkSubBoss",
      "MeleeGreatSwordSubBoss",
      "BaliqShrimp",
      "BaliqShrimpGlades",
      "SfProxy",
      "OrengallQuestSiegeEngine",
      "CorruptedBromius",
      "Envoy",
    ]);

    // App principale
    const App = () => {
      const [view, setView] = useState("PA");
      const [isTransitioning, setIsTransitioning] = useState(false);
      const [payload, setPayload] = useState(null);
      const [error, setError] = useState("");
      const [accountId, setAccountId] = useState("");
      const [isUpdating, setIsUpdating] = useState(false);
      const [updateMessage, setUpdateMessage] = useState("");
      const [activeTab, setActiveTab] = useState("player");
      const [openEnemyPanel, setOpenEnemyPanel] = useState("index");
      const [volume, setVolume] = useState(() => {
        try {
          const saved = localStorage.getItem("soulframe_volume");
          if (!saved) return 0.2;
          const v = parseFloat(saved);
          return Number.isFinite(v) && v >= 0 && v <= 1 ? v : 0.2;
        } catch {
          return 0.2;
        }
      });
      const [weaponDiffs, setWeaponDiffs] = useState({});
      const [enemyDiffs, setEnemyDiffs] = useState({});
      const [statDiffs, setStatDiffs] = useState({});
      const [hasChanges, setHasChanges] = useState(false);
      const [weaponBonuses, setWeaponBonuses] = useState({});
      const [enemyBonuses, setEnemyBonuses] = useState({});
      const [statBonuses, setStatBonuses] = useState({});
      const [loreLines, setLoreLines] = useState([]);
      const [loreIdx, setLoreIdx] = useState(0);
      const [showHelp, setShowHelp] = useState(false);
      const helpTimer = useRef(null);
      const [language, setLanguage] = useState("en");
      const [loreLinesFR, setLoreLinesFR] = useState([]);

      const openHelp = () => {
        if (helpTimer.current) clearTimeout(helpTimer.current);
        setShowHelp(true);
      };
      
      const closeHelp = () => {
        helpTimer.current = setTimeout(() => setShowHelp(false), 120);
      };

      useEffect(() => () => helpTimer.current && clearTimeout(helpTimer.current), []);

      // AccountId localStorage
      useEffect(() => {
        const saved = localStorage.getItem('soulframe_accountId');
        if (saved) setAccountId(saved);
      }, []);
      
      useEffect(() => {
        if (accountId) localStorage.setItem('soulframe_accountId', accountId);
      }, [accountId]);

      // Volume musique
      useEffect(() => {
        if (backgroundMusic) {
          backgroundMusic.volume = volume;
        }
        try {
          localStorage.setItem("soulframe_volume", String(volume));
        } catch {}
      }, [volume]);

      // Connecte le slider HTML au state React
      useEffect(() => {
        const slider = document.getElementById("musicVolume");
        if (!slider) return;

        slider.value = String(Math.round(volume * 100));

        const handleInput = (e) => {
          const val = parseFloat(e.target.value);
          if (!Number.isFinite(val)) return;
          const v = Math.min(Math.max(val / 100, 0), 1);
          setVolume(v);
        };

        slider.addEventListener("input", handleInput);
        slider.addEventListener("change", handleInput);

        return () => {
          slider.removeEventListener("input", handleInput);
          slider.removeEventListener("change", handleInput);
        };
      }, [volume]);

            // Zoom des images (uniquement dans le panneau de stats, pas sur les logos / musique)
      useEffect(() => {
        if (view !== "PS" || !payload) return;
        
        const container = document.getElementById("player-panel-root");
        if (!container) return;

        const initImageZoom = () => {
          let currentZoomed = null;
          let tooltip = null;

          function createTooltip() {
            tooltip = document.createElement('div');
            tooltip.className = 'image-zoom-tooltip';
            tooltip.style.cssText = `
              position: fixed;
              z-index: 999999;
              display: none;
              background: #0b0a08;
              border: 2px solid #d4af37;
              border-radius: 8px;
              padding: 12px;
              box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
              max-width: 320px;
              max-height: 350px;
              pointer-events: none;
              font-family: 'Merriweather', serif;
            `;
            document.body.appendChild(tooltip);
          }

          function getImageName(img) {
            let parent = img.parentElement;
            
            const flexContainer = img.closest('.flex.items-center.gap-3');
            if (flexContainer) {
              const nameElement = flexContainer.querySelector('.font-semibold.text-amber-50');
              if (nameElement) return nameElement.textContent.trim();
            }
            
            const tableRow = img.closest('tr');
            if (tableRow) {
              const nameCell = tableRow.querySelector('td:first-child .font-semibold');
              if (nameCell) return nameCell.textContent.trim();
            }
            
            const equipmentCard = img.closest('.relative.bg-\\[\\#0b0a08\\]');
            if (equipmentCard) {
              const titleElement = equipmentCard.querySelector('.text-sm.font-semibold');
              if (titleElement) return titleElement.textContent.trim();
            }
            
            if (img.alt && img.alt !== '') return img.alt;
            
            for (let i = 0; i < 3; i++) {
              if (!parent) break;
              const textElements = parent.querySelectorAll('.font-semibold, .text-amber-50, [class*="text-"]');
              for (let el of textElements) {
                const text = el.textContent.trim();
                if (text && text.length > 0 && text.length < 50) {
                  return text;
                }
              }
              parent = parent.parentElement;
            }
            
            return "Objet";
          }

          function showTooltip(img, x, y) {
            if (!tooltip) createTooltip();
            
            const rect = img.getBoundingClientRect();
            const scale = 2.5;
            const imageName = getImageName(img);
            
            tooltip.innerHTML = '';
            
            const nameElement = document.createElement('div');
            nameElement.style.cssText = `
              color: #fbbf24;
              font-weight: bold;
              font-size: 14px;
              margin-bottom: 8px;
              text-align: center;
              text-shadow: 0 0 4px rgba(0,0,0,0.9);
            `;
            nameElement.textContent = imageName;
            tooltip.appendChild(nameElement);
            
            const zoomedImg = document.createElement('img');
            zoomedImg.src = img.src;
            zoomedImg.alt = img.alt;
            zoomedImg.style.cssText = `
              width: ${Math.min(rect.width * scale, 280)}px;
              height: ${Math.min(rect.height * scale, 280)}px;
              object-fit: contain;
              display: block;
              margin: 0 auto;
              border-radius: 4px;
            `;
            tooltip.appendChild(zoomedImg);
            
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            let left = x + 20;
            let top = y + 20;
            
            if (left + 320 > viewportWidth) {
              left = x - 340;
            }
            if (top + 350 > viewportHeight) {
              top = y - 350;
            }
            
            tooltip.style.left = `${Math.max(10, left)}px`;
            tooltip.style.top = `${Math.max(10, top)}px`;
            tooltip.style.display = 'block';
            
            currentZoomed = img;
          }

          function hideTooltip() {
            if (tooltip) {
              tooltip.style.display = 'none';
            }
            currentZoomed = null;
          }

          function handleMouseMove(e) {
            if (currentZoomed && tooltip) {
              showTooltip(currentZoomed, e.clientX, e.clientY);
            }
          }

          function handleMouseEnter(img) {
            currentZoomed = img;
            const rect = img.getBoundingClientRect();
            showTooltip(img, rect.right, rect.top);
          }

          function handleMouseLeave() {
            hideTooltip();
          }

          // ðŸ”’ IMPORTANT : on ne cible que les images DANS le panneau de stats
          const imageSelectors = [
            'img[src*="wikitide.net"]',
            'img[src*="githubusercontent"]',
            '.weapon-image-container img',
            '.enemy-image-container img', 
            '.boss-image-container img',
            'table img',
            '.flex.items-center.gap-3 img'
          ];

          imageSelectors.forEach(selector => {
            container.querySelectorAll(selector).forEach(img => {
              if (!img.classList.contains('zoomable-image')) {
                img.classList.add('zoomable-image');
                img.style.cursor = 'zoom-in';
                
                img.addEventListener('mouseenter', () => handleMouseEnter(img));
                img.addEventListener('mouseleave', handleMouseLeave);
                img.addEventListener('mousemove', handleMouseMove);
              }
            });
          });

          // On nettoie les anciens tooltips au cas oÃ¹
          document.querySelectorAll('.image-zoom-tooltip').forEach(t => t.remove());
        };

        const timer = setTimeout(initImageZoom, 1000);
        return () => {
          clearTimeout(timer);
          document.querySelectorAll('.image-zoom-tooltip').forEach(t => t.remove());
        };
      }, [payload, activeTab, view]);


      const resetHighlights = () => {
        setWeaponDiffs({});
        setEnemyDiffs({});
        setStatDiffs({});
        setWeaponBonuses({});
        setEnemyBonuses({});
        setStatBonuses({});
        setHasChanges(false);
      };

      const computeDiffs = (oldData, newData) => {
        const oldStats = oldData?.Stats || {};
        const newStats = newData?.Stats || {};
        const oldWeapons = oldStats.Weapons || [];
        const newWeapons = newStats.Weapons || [];
        const oldEnemies = oldStats.Enemies || [];
        const newEnemies = newStats.Enemies || [];

        const weaponMapOld = {};
        oldWeapons.forEach((w) => {
          if (w.type) weaponMapOld[w.type] = w;
        });

        const enemyMapOld = {};
        oldEnemies.forEach((e) => {
          if (e.type) enemyMapOld[e.type] = e;
        });

        const weaponDiffs = {};
        const enemyDiffs = {};
        const statDiffs = {};
        const weaponBonuses = {};
        const enemyBonuses = {};
        const statBonuses = {};
        let hasChanges = false;

        const sum = (arr, key) =>
          arr.reduce((s, x) => s + (x?.[key] || 0), 0);

        // Weapons
        newWeapons.forEach((w) => {
          const key = w.type;
          if (!key) return;
          const old = weaponMapOld[key] || {};
          const diff = {};
          const bonus = {};

          const dk = (w.kills || 0) - (old.kills || 0);
          if (dk > 0) {
            diff.kills = true;
            bonus.kills = dk;
            hasChanges = true;
          }

          const dh = (w.headshots || 0) - (old.headshots || 0);
          if (dh > 0) {
            diff.headshots = true;
            bonus.headshots = dh;
            hasChanges = true;
          }

          const da = (w.assists || 0) - (old.assists || 0);
          if (da > 0) {
            diff.assists = true;
            bonus.assists = da;
            hasChanges = true;
          }

          const dxp = (w.xp || 0) - (old.xp || 0);
          if (dxp > 0) {
            diff.xp = true;
            bonus.xp = dxp;
            hasChanges = true;
          }

          const deq = (w.equipTime || 0) - (old.equipTime || 0);
          if (deq > 0) {
            diff.equipTime = true;
            bonus.equipTime = deq;
            hasChanges = true;
          }

          if (Object.keys(diff).length > 0) {
            weaponDiffs[key] = diff;
          }
          if (Object.keys(bonus).length > 0) {
            weaponBonuses[key] = bonus;
          }
        });

        // Enemies
        newEnemies.forEach((e) => {
          const key = e.type;
          if (!key) return;
          const old = enemyMapOld[key] || {};
          const diff = {};
          const bonus = {};

          const dk = (e.kills || 0) - (old.kills || 0);
          if (dk > 0) {
            diff.kills = true;
            bonus.kills = dk;
            hasChanges = true;
          }

          const dh = (e.headshots || 0) - (old.headshots || 0);
          if (dh > 0) {
            diff.headshots = true;
            bonus.headshots = dh;
            hasChanges = true;
          }

          const de = (e.executions || 0) - (old.executions || 0);
          if (de > 0) {
            diff.executions = true;
            bonus.executions = de;
            hasChanges = true;
          }

          const dd = (e.deaths || 0) - (old.deaths || 0);
          if (dd > 0) {
            diff.deaths = true;
            bonus.deaths = dd;
            hasChanges = true;
          }

          if (Object.keys(diff).length > 0) {
            enemyDiffs[key] = diff;
          }
          if (Object.keys(bonus).length > 0) {
            enemyBonuses[key] = bonus;
          }
        });

        // Stats globales
        const dTime = (newStats.TimePlayedSec || 0) - (oldStats.TimePlayedSec || 0);
        if (dTime > 0) {
          statDiffs.timePlayed = true;
          statBonuses.timePlayedSec = dTime;
          hasChanges = true;
        }

        const dPickup = (newStats.PickupCount || 0) - (oldStats.PickupCount || 0);
        if (dPickup > 0) {
          statDiffs.pickupCount = true;
          statBonuses.pickupCount = dPickup;
          hasChanges = true;
        }

        const dIncome = (newStats.Income || 0) - (oldStats.Income || 0);
        if (dIncome > 0) {
          statDiffs.income = true;
          statBonuses.income = dIncome;
          hasChanges = true;
        }

        const oldTotalEnemyKills = sum(oldEnemies, "kills");
        const newTotalEnemyKills = sum(newEnemies, "kills");
        const dEnemyKills = newTotalEnemyKills - oldTotalEnemyKills;
        if (dEnemyKills > 0) {
          statDiffs.totalEnemyKills = true;
          statBonuses.totalEnemyKills = dEnemyKills;
          hasChanges = true;
        }

        const oldTotalWeaponKills = sum(oldWeapons, "kills");
        const newTotalWeaponKills = sum(newWeapons, "kills");
        const dWeaponKills = newTotalWeaponKills - oldTotalWeaponKills;
        if (dWeaponKills > 0) {
          statDiffs.totalWeaponKills = true;
          statBonuses.totalWeaponKills = dWeaponKills;
          hasChanges = true;
        }

        const uniqTypesOld = new Set(
          oldEnemies.map((e) => e.type?.split("/")?.pop() || "")
        ).size;
        const uniqTypesNew = new Set(
          newEnemies.map((e) => e.type?.split("/")?.pop() || "")
        ).size;
        const dTypes = uniqTypesNew - uniqTypesOld;
        if (dTypes > 0) {
          statDiffs.uniqueEnemyTypes = true;
          statBonuses.uniqueEnemyTypes = dTypes;
          hasChanges = true;
        }

        return {
          weaponDiffs,
          enemyDiffs,
          statDiffs,
          weaponBonuses,
          enemyBonuses,
          statBonuses,
          hasChanges,
        };
      };

      // Fetch + transition
      async function fetchViaId(idOverride) {
        const id = idOverride || accountId;
        if (!id) return setError("Veuillez entrer un AccountId valide.");

        try {
          setIsUpdating(true);
          setError("");

          const url = `${PROXY}${encodeURIComponent(SOULFRAME_API + id)}`;
          const res = await fetch(url);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const json = await res.json();
          if (json?.error) throw new Error(json.error);

          setUpdateMessage("âœ… DonnÃ©es prÃªtes");
          setTimeout(() => setUpdateMessage(""), 1500);

          setIsTransitioning(true);
          const D_VEIL   = 2600;
          const T_SWITCH = 1850;
          const T_END    = D_VEIL + 80;
           
          setTimeout(() => {
            resetHighlights();
            setPayload(json);
            setView("PS");
            setActiveTab("player");
            if (backgroundMusic && !musicStarted) startBackgroundMusic();
          }, T_SWITCH);

          setTimeout(() => {
            setIsTransitioning(false);
          }, T_END);

        } catch (e) {
          setError(e?.message || String(e));
          setUpdateMessage("âŒ Ã‰chec de la mise Ã  jour");
          setTimeout(() => setUpdateMessage(""), 3000);
        } finally {
          setIsUpdating(false);
        }
      }

      // RafraÃ®chit les donnÃ©es
      async function refreshData() {
        if (!accountId) {
          setError("Veuillez entrer un AccountId valide.");
          return;
        }
        if (!payload) {
          return fetchViaId();
        }

        try {
          setIsUpdating(true);
          setError("");

          const url = `${PROXY}${encodeURIComponent(SOULFRAME_API + accountId)}`;
          const res = await fetch(url);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const json = await res.json();
          if (json?.error) throw new Error(json.error);

          const {
            weaponDiffs,
            enemyDiffs,
            statDiffs,
            weaponBonuses,
            enemyBonuses,
            statBonuses,
            hasChanges,
          } = computeDiffs(payload, json);

          setWeaponDiffs(weaponDiffs);
          setEnemyDiffs(enemyDiffs);
          setStatDiffs(statDiffs);
          setWeaponBonuses(weaponBonuses);
          setEnemyBonuses(enemyBonuses);
          setStatBonuses(statBonuses);
          setHasChanges(hasChanges);

          setPayload(json);

          if (hasChanges) {
            setUpdateMessage("âœ… Nouvelles donnÃ©es dÃ©tectÃ©es");
          } else {
            setUpdateMessage("âœ… Aucune nouvelle donnÃ©e (dÃ©jÃ  Ã  jour)");
          }
          setTimeout(() => setUpdateMessage(""), 2500);
        } catch (e) {
          setError(e?.message || String(e));
          setUpdateMessage("âŒ Ã‰chec de la mise Ã  jour");
          setTimeout(() => setUpdateMessage(""), 3000);
        } finally {
          setIsUpdating(false);
        }
      }

      // Exporte les donnÃ©es en CSV
      function downloadData() {
        if (!payload) return;

        const rows = [];

        // Player section
        rows.push(["Section", "Key", "Value"]);
        rows.push(["Player", "Account Name", playerInfo?.name ?? ""]);
        rows.push(["Player", "Mastery", playerInfo?.mastery ?? ""]);
        rows.push(["Player", "Account Created", playerInfo?.created ?? ""]);
        rows.push(["Player", "Time Played (h)", playerInfo?.timePlayedH ?? ""]);
        rows.push(["Player", "Items Collected", playerInfo?.pickupCount ?? ""]);
        rows.push(["Player", "Total Dracs", playerInfo?.income ?? ""]);
        rows.push([]);

        // Weapons
        rows.push([
          "Weapons",
          "Display Name",
          "Group",
          "Category",
          "Kills",
          "Headshots",
          "Assists",
          "XP",
          "EquipTime(sec)",
          "Raw type",
        ]);
        weapons.forEach((w) => {
          const display = getWeaponDisplayData(w.type);
          const cat = getWeaponCategory(w.type);
          rows.push([
            "Weapons",
            display.name,
            display.group,
            cat,
            w.kills || 0,
            w.headshots || 0,
            w.assists || 0,
            w.xp || 0,
            w.equipTime || 0,
            w.type || "",
          ]);
        });
        rows.push([]);

        // Enemies
        rows.push([
          "Enemies",
          "Id",
          "Display Name",
          "Faction",
          "Biome",
          "Kills",
          "Headshots",
          "Executions",
          "Deaths",
        ]);
        enrichedEnemies.forEach((e) => {
          rows.push([
            "Enemies",
            e.baseId || "",
            e.name || "",
            e.faction || "",
            e.biome || "",
            e.kills || 0,
            e.headshots || 0,
            e.executions || 0,
            e.deaths || 0,
          ]);
        });

        const csv = rows
          .map((row) =>
            row
              .map((v) =>
                `"${String(v ?? "")
                  .replace(/"/g, '""')
                  .trim()}"`
              )
              .join(",")
          )
          .join("\r\n");

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "soulframe_tracker_data.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Lore
      useEffect(() => {
        if (payload) return;
        let timer;
        (async () => {
          try {
            const resEN = await fetch(LORE_URL);
            let listEN = await resEN.json();
            if (Array.isArray(listEN)) {
              listEN = Array.from(new Set(listEN.map(s => (typeof s === "string" ? s.trim() : "")).filter(Boolean)));
            } else listEN = [];

            let listFR = [];
            try {
              const resFR = await fetch(LORE_URL.replace("lore.json", "lore_fr.json"));
              listFR = await resFR.json();
            } catch { }

            setLoreLines(listEN);
            setLoreLinesFR(listFR);
            setLoreIdx(Math.floor(Math.random() * listEN.length));
            timer = setInterval(() => setLoreIdx(p => (p + 1) % listEN.length), 20000);
          } catch { }
        })();
        return () => timer && clearInterval(timer);
      }, [payload]);

      // DÃ©coupe payload
      const r0 = payload?.Results?.[0];
      const stats = payload?.Stats || {};
      const abilities = stats.Abilities || [];
      const enemies = stats.Enemies || [];
      const weapons = stats.Weapons || [];

      // Info joueur
      const playerInfo = useMemo(() => {
        if (!r0) return null;
        const created = r0?.Created?.$date?.$numberLong;
        const factions = r0?.Affiliations || [];
        const championFaction = factions.find(f => f.Tag === "ChampionSyndicate");
        const feyFaction = factions.find(f => f.Tag === "FeySyndicate");
        const silentRoseFaction = factions.find(f => f.Tag === "SilentRoseSyndicate");
        return {
          name: r0?.DisplayName,
          accountOid: r0?.AccountId?.$oid,
          created: created ? new Date(Number(created)).toLocaleDateString() : "â€”",
          mastery: stats?.PlayerLevel ?? "â€”",
          timePlayedH: stats?.TimePlayedSec ? (stats.TimePlayedSec / 3600).toFixed(1) + " h" : "â€”",
          migrated: r0?.MigratedToConsole ? "Yes" : "No",
          xp: stats?.XP ? stats.XP.toLocaleString() : "â€”",
          pickupCount: stats?.PickupCount ? stats.PickupCount.toLocaleString() : "â€”",
          income: stats?.Income ? stats.Income.toLocaleString() : "â€”",
          championStanding: championFaction?.Standing ?? 0,
          championTitle: championFaction?.Title ?? 0,
          feyStanding: feyFaction?.Standing ?? 0,
          feyTitle: feyFaction?.Title ?? 0,
          silentRoseStanding: silentRoseFaction?.Standing ?? 0,
          silentRoseTitle: silentRoseFaction?.Title ?? 0
        };
      }, [r0, stats]);

      // CapacitÃ©s groupÃ©es par pacte
      const groupedAbilities = useMemo(() => {
        const groups = {};
        abilities.forEach(ab => {
          const key = ab.type?.split("/")?.pop();
          const meta = ABILITY_LABELS[key];
          if (!meta) return;
          if (!groups[meta.group]) groups[meta.group] = [];
          groups[meta.group].push({ name: meta.name, used: ab.used, icon: meta.icon });
        });
        return groups;
      }, [abilities]);

      // Ennemis groupÃ©s
      const groupedEnemies = useMemo(() => {
        const groups = {};
        groups.SUBBOSS = {
          name: SUBBOSS_CATEGORY.name,
          enemies: enemies.filter(e => SUBBOSS_CATEGORY.enemies.includes(e.type?.split("/")?.pop()))
        };
        Object.entries(ENEMY_CATEGORIES).forEach(([k, cat]) => {
          groups[k] = {
            name: cat.name,
            enemies: enemies.filter(e => cat.enemies.includes(e.type?.split("/")?.pop()))
          };
        });
        return groups;
      }, [enemies]);

      // Utils armes
      const getWeaponCategory = (weaponType) => {
        const key = weaponType?.split("/")?.pop();
        const data = WEAPON_NAMES[key];
        return data ? data.category : "unknown";
      };
      
      const getWeaponGroup = (weaponType) => {
        const key = weaponType?.split("/")?.pop();
        const data = WEAPON_NAMES[key];
        return data ? data.group : "Unknown";
      };
      
      const getWeaponDisplayData = (weaponType) => {
        const key = weaponType?.split("/")?.pop();
        const data = WEAPON_NAMES[key];
        return data ? { name: data.name, icon: data.icon, group: data.group } : { name: key || "Unknown Weapon", icon: "â“", group: "Unknown" };
      };

      // Armes groupÃ©es
      const groupedWeapons = useMemo(() => {
        const groups = { main: {}, secondary: {}, unknown: [] };
        weapons.forEach(w => {
          const category = getWeaponCategory(w.type);
          const group = getWeaponGroup(w.type);
          if (category === "unknown") {
            groups.unknown.push(w);
          } else {
            if (!groups[category][group]) groups[category][group] = [];
            groups[category][group].push(w);
          }
        });
        return groups;
      }, [weapons]);

      // Totaux combat
      const totalStats = useMemo(() => {
        const totalKills = weapons.reduce((s, w) => s + (w.kills || 0), 0);
        const totalHeadshots = weapons.reduce((s, w) => s + (w.headshots || 0), 0);
        const totalEnemyKills = enemies.reduce((s, e) => s + (e.kills || 0), 0);
        return {
          totalKills, totalHeadshots, totalEnemyKills,
          headshotRatio: totalKills ? ((totalHeadshots / totalKills) * 100).toFixed(1) + "%" : "0%"
        };
      }, [weapons, enemies]);

      // Ennemis enrichis pour compendium
      const enrichedEnemies = useMemo(
        () =>
          enemies.map((e) => {
            const fullKey = e.type?.split("/")?.pop() || "";
            const baseKey = fullKey.replace(/Avatar$/, "");
            const meta = ENEMY_COMPENDIUM[fullKey] || {};

            let displayName = meta.name || baseKey.replace(/([a-z])([A-Z])/g, "$1 $2").trim();
            if (ENEMY_RENAMES[baseKey]) {
              displayName = ENEMY_RENAMES[baseKey];
            }

            let faction = meta.faction || ENEMY_FACTION[baseKey] || null;
            if (!faction) {
              if (baseKey.startsWith("Mockery")) {
                faction = "Mockery";
              } else if (baseKey === "SquidplantChild") {
                faction = "Hazards";
              } else if (baseKey === "BaliqShrimp" || baseKey === "BaliqShrimpGlades") {
                faction = "Corrupted";
              } else if (/Grunt/.test(baseKey)) {
                faction = "Ode";
              } else if (baseKey === "MendicantKnight") {
                faction = "Mendicant";
              }
            }
            if (!faction) faction = "Unknown";

            let biome = meta.biome || ENEMY_DUNGEON[baseKey] || "â€”";
            

            const eventTag = ENEMY_EVENT[baseKey] || null;
            const isSpectre = ENEMY_SPECTRES.includes(baseKey);

            return {
              ...e,
              id: fullKey,
              baseId: baseKey,
              name: displayName,
              faction,
              biome,
              category: meta.type || "Unknown",
              icon: meta.icon || null,
              eventTag,
              isSpectre
            };
          }),
        [enemies]
      );

      // Vue d'ensemble des ennemis
      const enemyOverview = useMemo(() => {
        if (!enrichedEnemies.length) {
          return {
            uniqueTypes: 0,
            killsByFaction: [],
            topFaction: null
          };
        }

        const typeSet = new Set();
        const killsByFactionMap = {};

        enrichedEnemies.forEach(e => {
          if (e.id) typeSet.add(e.id);
          const f = e.faction || "Unknown";
          const kills = e.kills || 0;
          killsByFactionMap[f] = (killsByFactionMap[f] || 0) + kills;
        });

        const killsByFaction = Object.entries(killsByFactionMap)
          .map(([faction, kills]) => ({ faction, kills }))
          .sort((a, b) => b.kills - a.kills);

        return {
          uniqueTypes: typeSet.size,
          killsByFaction,
          topFaction: killsByFaction[0] || null
        };
      }, [enrichedEnemies]);

      // Tri du Compendium Enemies
      const [enemySort, setEnemySort] = useState({
        key: "kills",
        direction: "desc"
      });

      const enemySortDefaults = {
        enemy: "asc",
        faction: "asc",
        biome: "asc",
        tags: "asc",
        kills: "desc",
        headshots: "desc",
        executions: "desc"
      };

      const handleEnemySortChange = (key) => {
        setEnemySort((prev) => {
          if (prev?.key === key) {
            return {
              key,
              direction: prev.direction === "asc" ? "desc" : "asc"
            };
          }
          return {
            key,
            direction: enemySortDefaults[key] || "asc"
          };
        });
      };

      // Tri des ennemis pour l'index
      const sortedEnrichedEnemies = useMemo(() => {
        const base = enrichedEnemies
          .filter((e) => !COMPENDIUM_EXCLUDED.has((e.baseId || e.id || "").replace(/Avatar$/, "")));

        const { key, direction } = enemySort || {};
        if (!key) return base;

        const dir = direction === "asc" ? 1 : -1;

        const getValue = (enemy) => {
          switch (key) {
            case "enemy":
              return enemy.name || "";
            case "faction":
              return enemy.faction || "";
            case "biome":
              return enemy.biome || "";
            case "tags": {
              const tags = [];
              if (enemy.category && enemy.category !== "Unknown") tags.push(enemy.category);
              if (enemy.eventTag) tags.push(enemy.eventTag);
              return tags.join(", ");
            }
            case "kills":
              return enemy.kills || 0;
            case "headshots":
              return enemy.headshots || 0;
            case "executions":
              return enemy.executions || 0;
            default:
              return 0;
          }
        };

        const hasEnemyDiff = (enemy) => {
          const d = enemyDiffs[enemy.type] || {};
          return d.kills || d.headshots || d.executions || d.deaths;
        };

        return [...base].sort((a, b) => {
          const da = hasEnemyDiff(a) ? 1 : 0;
          const db = hasEnemyDiff(b) ? 1 : 0;
          if (da !== db) return db - da;

          const va = getValue(a);
          const vb = getValue(b);

          if (typeof va === "number" && typeof vb === "number") {
            return (va - vb) * dir;
          }
          return String(va).localeCompare(String(vb)) * dir;
        });
      }, [enrichedEnemies, enemySort, enemyDiffs]);

      // Ennemis standards
      const standardEnemiesSorted = useMemo(
        () => sortedEnrichedEnemies.filter(e => !SUBBOSS_CATEGORY.enemies.includes(e.id)),
        [sortedEnrichedEnemies]
      );

      // Groupes par faction
      const factionGroups = useMemo(() => {
        const groups = {};
        standardEnemiesSorted.forEach(e => {
          const faction = e.faction || "Unknown";
          if (!groups[faction]) {
            groups[faction] = { enemies: [], totalKills: 0 };
          }
          groups[faction].enemies.push(e);
          groups[faction].totalKills += e.kills || 0;
        });
        return Object.entries(groups).sort(
          (a, b) => b[1].totalKills - a[1].totalKills
        );
      }, [standardEnemiesSorted]);

      // SubBoss display name
      const getSubBossDisplayName = (enemyType) => {
        const key = enemyType?.split("/")?.pop();
        return SUBBOSS_CATEGORY.labels[key]?.name || key || "Unknown";
      };

      // Favoris
      const favoriteEquipment = useMemo(() => {
        if (!payload) return null;

        const pactUsage = {};
        Object.entries(groupedAbilities).forEach(([pact, arr]) => {
          pactUsage[pact] = arr.reduce((s, ab) => s + (ab.used || 0), 0);
        });
        const favoritePact = Object.entries(pactUsage).reduce((m, [p, u]) => (u > (m.usage || 0) ? { pact: p, usage: u } : m), {});

        const favMain = Object.values(groupedWeapons.main).flat().reduce((m, w) => {
          const t = w.equipTime || 0;
          return t > (m.equipTime || 0) ? { name: getWeaponDisplayData(w.type).name, equipTime: t } : m;
        }, {});

        const favSec = Object.values(groupedWeapons.secondary).flat().reduce((m, w) => {
          const t = w.equipTime || 0;
          return t > (m.equipTime || 0) ? { name: getWeaponDisplayData(w.type).name, equipTime: t } : m;
        }, {});

        const favSB = (groupedEnemies.SUBBOSS?.enemies || []).reduce((m, e) => {
          const k = e.kills || 0;
          return k > (m.kills || 0) ? { name: getSubBossDisplayName(e.type), kills: k } : m;
        }, {}) || { name: "Aucun", kills: 0 };

        return { favoritePact, favoriteMainWeapon: favMain, favoriteSecondaryWeapon: favSec, favoriteSubBoss: favSB };
      }, [payload, groupedAbilities, groupedWeapons, groupedEnemies]);

      // Helpers formatage
      const formatXP = (xp) =>
        xp >= 1e6 ? (xp/1e6).toFixed(1)+'M' :
        xp >= 1e3 ? (xp/1e3).toFixed(1)+'K' :
        (xp||0).toLocaleString();

      const activeTabConf = useMemo(
        () => ongletsConfig.find(o => o.id === activeTab) || ongletsConfig[0],
        [activeTab]
      );

      // Rendu
      return (
        <div className="min-h-screen flex flex-col text-amber-100 font-[Merriweather] selection:bg-amber-500/20">

          {/* Header sticky */}
          {payload && (
            <nav
              className="sticky top-0 z-50 backdrop-blur-md bg-[#12120f]/90 border-b border-amber-900/40 shadow-2xl shadow-amber-900/10"
              aria-label="Navigation principale"
            >
              <div className="max-w-7xl mx-auto px-4 py-4">
                <div className="grid grid-cols-[auto,1fr,auto] items-center">
                  
                  {/* Bouton Retour */}
                  <div className="flex items-center justify-start">
                    {view === "PS" && (
                      <button
                        onClick={() => {
                          setView("PA");
                          setPayload(null);
                          resetHighlights();
                          setActiveTab("player");
                          window.scrollTo({ top: 0, behavior: "smooth" });
                        }}
                      >
                        <img
                          src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/Retour.png"
                          alt="Retour"
                          className="w-12 h-12 object-contain drop-shadow-[0_0_8px_rgba(212,175,55,0.4)] hover:drop-shadow-[0_0_12px_rgba(212,175,55,0.6)] transition-all duration-300"
                        />
                      </button>
                    )}
                  </div>

                  {/* Logo + titre */}
                  <div className="flex items-center gap-3 justify-self-center">
                    <div className="w-[72px] h-[72px] flex items-center justify-center rounded-lg overflow-hidden">
                      <img
                        src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/logoV1big.png"
                        alt="Soulframe Tracker Logo"
                        className="w-full h-full object-contain"
                      />
                    </div>
                  </div>

                  {/* Colonne droite vide */}
                  <div />
                </div>
              </div>
            </nav>
          )}

          {/* Toast de mise Ã  jour */}
          {updateMessage && (
            <div className={`fixed top-20 left-1/2 -translate-x-1/2 ${updateMessage.includes("âœ…") ? "bg-green-900/90" : "bg-red-900/90"} text-amber-100 px-6 py-3 rounded-lg text-sm shadow-2xl transition-all duration-500 animate-fade-in-out z-50 border ${updateMessage.includes("âœ…") ? "border-green-700/50" : "border-red-700/50"}`} role="status" aria-live="polite">
              {updateMessage}
            </div>
          )}

          {/* Contenu principal */}
          <main className="flex-1 max-w-7xl mx-auto px-4 py-8">
            <div className="h-2 sm:h-0" />

            <div className="page-stack">
              {/* Erreur API */}
              {error && (
                <div className="mb-6 p-4 bg-red-900/20 border border-red-700/40 rounded-xl text-red-200 text-sm">
                  âŒ Erreur: {error}
                </div>
              )}

              {/* PAGE D'ACCUEIL */}
              <div
                className={`view ${view === "PA" ? "" : "hidden"}`}
                id="PA"
                aria-hidden={view !== "PA"}
              >
                {!payload && !error && (
                  <div className="text-center py-16 text-amber-300/70">
                    {/* Logo principal */}
                    <div className="flex justify-center mb-5">
                      <div className="w-[352px] h-[352px] flex items-center justify-center rounded-lg overflow-hidden">
                        <img
                          src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/logoV1big.png"
                          alt="Soulframe Tracker Logo"
                          className="w-full h-full object-contain"
                        />
                      </div>
                    </div>

                    {/* Logo texte */}
                    <div className="flex justify-center mb-8 mt-[-90px]">
                      <img
                        src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/Soulframe_Tracker_name.png"
                        alt="Soulframe Tracker"
                        className="w-[252px] h-[252px] object-contain"
                      />
                    </div>

                    {/* Zone de saisie AccountId */}
                    <div className="flex justify-center mb-8">
                      <div className="w-full max-w-2xl flex items-stretch gap-3">
                        <div className="flex-1">
                          <div className="rounded-xl border border-amber-700/40 bg-[#13120F]/90 shadow-2xl shadow-amber-900/10 overflow-hidden">
                            <div className="grid grid-cols-[1fr_auto] items-stretch">
                              <div className="relative">
                                <input
                                  type="text"
                                  value={accountId}
                                  onChange={(e) => setAccountId(e.target.value)}
                                  placeholder="AccountId â€¦"
                                  className="w-full h-14 pl-5 pr-5 bg-transparent outline-none text-amber-200 placeholder-amber-400/30"
                                  onKeyDown={(e) => e.key === "Enter" && fetchViaId()}
                                  aria-label="Saisir votre AccountId Soulframe"
                                />
                              </div>
                              <button
                                onClick={() => fetchViaId()}
                                disabled={isUpdating}
                                className="h-14 px-8 font-semibold tracking-wide bg-[#12110E] hover:bg-[#12110E] text-amber-200 hover:text-amber-400 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                title="Entrer"
                              >
                                {isUpdating ? "Loadingâ€¦" : "Enter"}
                              </button>
                            </div>
                          </div>
                        </div>

                        {/* Helper tooltip */}
                        <div className="flex items-center">
                          <div
                            className="relative"
                            onMouseEnter={openHelp}
                            onMouseLeave={closeHelp}
                            onFocus={openHelp}
                            onBlur={closeHelp}
                          >
                            <button
                              type="button"
                              aria-expanded={showHelp}
                              aria-haspopup="dialog"
                              className="w-7 h-7 flex items-center justify-center rounded-full border border-amber-700/60 text-amber-300/80 text-sm bg-amber-900/40 hover:bg-amber-800/70 hover:text-amber-100 transition-colors shadow-md"
                              title="Comment trouver votre Account ID Soulframe ?"
                            >
                              ?
                            </button>

                            {showHelp && (
                              <div
                                role="dialog"
                                aria-label="Aide pour trouver l'Account ID"
                                className="absolute left-full top-1/2 -translate-y-1/2 ml-3 w-80 z-[100000] select-text"
                                onMouseEnter={openHelp}
                                onMouseLeave={closeHelp}
                              >
                                <div className="bg-[#11100d]/95 border border-amber-700/60 rounded-xl p-3 text-xs text-left text-amber-100 shadow-2xl shadow-amber-900/40 pointer-events-auto">
                                  <p className="font-semibold text-amber-300 mb-1">
                                    ðŸ” Comment trouver votre Account ID Soulframe ?
                                  </p>
                                  <p className="mb-1">
                                    ðŸ“‹ <span className="font-semibold">MÃ©thode recommandÃ©e :</span>
                                  </p>
                                  <ul className="list-disc list-inside space-y-0.5 mb-2 text-amber-100/90">
                                    <li>Ouvrez le launcher Soulframe</li>
                                    <li>Allez dans <span className="font-semibold">ParamÃ¨tres âš™ï¸</span></li>
                                    <li>Cliquez sur <span className="font-semibold">Â« Diagnostique [Fichiers Logs] Â»</span></li>
                                    <li>Un dossier sera crÃ©Ã© sur votre Bureau</li>
                                    <li>Ouvrez le fichier <span className="font-semibold">EE.log</span></li>
                                    <li>
                                      Appuyez sur <span className="font-semibold">Ctrl + F</span> et cherchez :
                                      <code className="font-mono text-amber-200 block my-2">Sys [Info]: Logged in</code>
                                    </li>
                                    <li>Votre pseudo et votre Account ID (24 caractÃ¨res) seront indiquÃ©s</li>
                                  </ul>
                                  <p className="mb-1">
                                    ðŸ”„ <span className="font-semibold">Si la recherche ne donne rien :</span>
                                  </p>
                                  <ul className="list-disc list-inside space-y-0.5 mb-2 text-amber-100/90">
                                    <li>Lancez le jeu, jouez 1â€“2 minutes puis fermez-le proprement</li>
                                    <li>Refaites un Â« Diagnostique [Fichiers Logs] Â» et recherchez Ã  nouveau</li>
                                  </ul>
                                  <p className="mt-1 text-amber-300/90">
                                    âš ï¸ <span className="font-normal text-amber-200/90">
                                      Votre Account ID est personnel â€“ partagez-le uniquement avec des sources de confiance.
                                    </span>
                                  </p>
                                </div>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Lore panneau */}
                    <div className="max-w-3xl mx-auto px-6 relative">
                      <button
                        onClick={() => setLanguage(language === "en" ? "fr" : "en")}
                        className="absolute top-3 right-4 text-xs text-amber-400/70 hover:text-amber-200 transition-colors bg-amber-900/20 border border-amber-800/40 px-2 py-1 rounded-md backdrop-blur-sm"
                        title={language === "en" ? "Afficher en franÃ§ais" : "Show in English"}
                      >
                        {language === "en" ? "FR" : "EN"}
                      </button>

                      <div className="bg-[#0f0f0e]/70 border border-amber-800/40 rounded-xl p-6 shadow-amber-900/10 shadow-2xl lore-panel">
                        <p
                          key={`${language}-${loreIdx}`}
                          className="lore-anim text-amber-200/90 text-lg sm:text-xl leading-relaxed tracking-wide break-words"
                        >
                          {language === "en"
                            ? loreLines[loreIdx] ?? "â€¦"
                            : loreLinesFR[loreIdx] ?? loreLines[loreIdx] ?? "â€¦"}
                        </p>
                      </div>

                      <div className="mt-3 text-xs text-amber-400/60">
                        <span>Credit: Avakot.org</span>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* PAGE STATS */}
              <div
                className={`view ${view === "PS" ? "" : "hidden"}`}
                id="PS"
                aria-hidden={view !== "PS"}
              >
                {/* Cadre principal */}
                <section id="player-panel-root" className="scroll-mt-24">
                  <div className="flex flex-col lg:flex-row gap-0 items-stretch mb-8 lg:-ml-20">
                    {/* Navigation verticale */}
                    <aside className="
                      w-full lg:w-40
                      flex-shrink-0
                      flex lg:flex-col
                      gap-2
                      mt-4
                      mb-4 lg:mb-0
                      lg:mt-20
                    ">
                      {ongletsConfig.map((tab) => {
                        const isActive = activeTab === tab.id;

                        return (
                          <button
                            key={tab.id}
                            type="button"
                            onClick={() => setActiveTab(tab.id)}
                            className={`
                              relative w-full lg:w-auto text-left
                              px-2 py-2 lg:px-3 lg:py-2
                              rounded-xl lg:rounded-l-2xl lg:rounded-r-none
                              border text-sm font-semibold tracking-wide
                              transition-all duration-200
                              shadow-[0_0_12px_rgba(0,0,0,0.6)]
                              ${
                                isActive
                                  ? "bg-[#1f1509] border-amber-400 text-amber-50 translate-x-0"
                                  : "bg-[#0f0b07]/90 border-amber-800/70 text-amber-200 hover:bg-[#17100a] hover:border-amber-400/70 hover:translate-x-[2px]"
                              }
                            `}
                          >
                            <span className="flex items-center gap-2">
                              <span className="uppercase tracking-[0.16em] text-xs text-amber-300/80">
                                {tab.id === "boss" ? "Boss" : tab.label}
                              </span>
                            </span>
                          </button>
                        );
                      })}
                    </aside>

                    {/* Colonne droite : actions + contenu */}
                    <div className="flex-1 flex flex-col gap-3">
                      {/* Barre d'actions */}
                      <div className="flex flex-wrap items-center justify-between gap-2">
                        <div className="flex gap-2">
                          <button
                            onClick={refreshData}
                            disabled={isUpdating || !payload}
                            className="
                              px-4 py-2
                              text-sm font-semibold
                              rounded-lg
                              bg-amber-900/40
                              border border-amber-700/70
                              text-amber-100
                              hover:bg-amber-800/70
                              hover:border-amber-500/80
                              disabled:opacity-50 disabled:cursor-not-allowed
                              transition-colors
                            "
                          >
                            {isUpdating ? "Updatingâ€¦" : "Update"}
                          </button>

                          <button
                            onClick={resetHighlights}
                            disabled={!hasChanges}
                            className="
                              px-4 py-2
                              text-sm
                              rounded-lg
                              bg-[#15120d]
                              border border-amber-800/60
                              text-amber-200
                              hover:bg-amber-900/60
                              hover:border-amber-500/70
                              disabled:opacity-40 disabled:cursor-not-allowed
                              transition-colors
                            "
                          >
                            Reset colors
                          </button>
                        </div>

                        <button
                          onClick={downloadData}
                          disabled={!payload}
                          className="
                            px-4 py-2
                            text-sm font-semibold
                            rounded-lg
                            bg-emerald-900/40
                            border border-emerald-700/70
                            text-emerald-100
                            hover:bg-emerald-800/80
                            hover:border-emerald-500/80
                            disabled:opacity-50 disabled:cursor-not-allowed
                            transition-colors
                          "
                        >
                          Download my data (Excel)
                        </button>
                      </div>

                      {/* Conteneur principal */}
                      <div className="
                        relative
                        flex-1
                        bg-[#0b0a08]/90
                        border border-amber-700/70
                        rounded-2xl
                        shadow-[0_0_22px_rgba(0,0,0,0.85)]
                        p-6
                        backdrop-blur-sm
                        flex flex-col
                        min-h-[620px]
                      ">
                        <div className="absolute inset-1 rounded-2xl border border-amber-400/70 pointer-events-none" />

                        <div className="relative z-10">
                          <div className="mb-3 text-[11px] tracking-[0.26em] uppercase text-amber-400/80">
                            {(() => {
                              const current = ongletsConfig.find((o) => o.id === activeTab);
                              return current ? current.label.trim() : activeTab;
                            })()}
                          </div>

                          {/* Contenu dynamique */}
                          <section className="min-w-0">
                            <header className="mb-5 pb-3 border-b border-amber-800/50 flex items-center justify-between">
                              <h2 className="text-2xl font-serif text-amber-200 drop-shadow">
                                {activeTabConf.label}
                              </h2>
                            </header>

                            {/* CONTENU ONGLET PLAYER */}
                            {activeTab === "player" && (
                              <div className="space-y-8">
                                {/* MR + Account + mini stats */}
                                <div className="relative rounded-2xl overflow-hidden">
                                  <div className="relative z-10 p-4 sm:p-6 lg:p-7 flex flex-col gap-8">
                                    <div className="flex flex-col lg:flex-row gap-8 lg:gap-10 items-stretch">
                                      {/* Bloc MR + pseudo */}
                                      <div className="w-full lg:w-[420px]">
                                        <div className="
                                          relative
                                          bg-[#0b0a08]/90
                                          border border-amber-700/70
                                          rounded-xl
                                          shadow-[0_0_22px_rgba(0,0,0,0.85)]
                                          px-6 py-5
                                          flex items-center gap-6
                                        ">
                                          <div className="absolute inset-1 rounded-lg border-2 border-amber-400/70 pointer-events-none" />
                                          {/* SphÃ¨re MR */}
                                          <div
                                            className="relative flex items-center justify-center"
                                            style={{ width: "140px", height: "140px" }}
                                          >
                                            <img
                                              src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/Sphere_MR%20.png"
                                              alt="Mastery Rank"
                                              className="absolute inset-0 w-full h-full object-contain drop-shadow-[0_0_18px_rgba(212,175,55,0.45)] select-none pointer-events-none"
                                            />
                                            <span className="relative z-10 text-5xl font-bold text-amber-50 drop-shadow-[0_0_10px_rgba(0,0,0,0.95)] select-none">
                                              {playerInfo?.mastery ?? "â€”"}
                                            </span>
                                          </div>
                                          {/* Nom de compte */}
                                          <div className="flex-1">
                                            <div className="text-[11px] tracking-[0.18em] uppercase text-amber-300/75 mb-1">
                                              Account Name
                                            </div>
                                            <div className="text-3xl font-serif font-bold text-amber-50 drop-shadow-[0_0_10px_rgba(0,0,0,0.9)] break-words">
                                              {playerInfo?.name ?? "â€”"}
                                            </div>
                                          </div>
                                        </div>
                                      </div>

                                      {/* 4 mini-cards stats */}
                                      <div className="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4 items-start">
                                        <MiniStatCard
                                          label="TIME PLAYED"
                                          value={playerInfo?.timePlayedH ?? "â€”"}
                                          icon={
                                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                                              <circle cx="12" cy="12" r="8" stroke="#CDAF55" strokeWidth="1.7" />
                                              <path
                                                d="M12 7v5l3 2"
                                                stroke="#E5D7A2"
                                                strokeWidth="1.6"
                                                strokeLinecap="round"
                                              />
                                            </svg>
                                          }
                                          highlight={!!statDiffs.timePlayed}
                                          badgeLabel={
                                            statBonuses.timePlayedSec
                                              ? `+${(statBonuses.timePlayedSec / 3600).toFixed(1)}h`
                                              : ""
                                          }
                                        />

                                        <MiniStatCard
                                          label="ACCOUNT CREATED"
                                          value={playerInfo?.created ?? "â€”"}
                                          icon={
                                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                                              <rect
                                                x="4"
                                                y="5"
                                                width="16"
                                                height="14"
                                                rx="2"
                                                stroke="#CDAF55"
                                                strokeWidth="1.7"
                                              />
                                              <path d="M4 9h16" stroke="#E5D7A2" strokeWidth="1.3" />
                                              <path
                                                d="M8 3v4M16 3v4"
                                                stroke="#E5D7A2"
                                                strokeWidth="1.3"
                                                strokeLinecap="round"
                                              />
                                            </svg>
                                          }
                                        />

                                        <MiniStatCard
                                          label="ITEMS COLLECTED"
                                          value={playerInfo?.pickupCount ?? "â€”"}
                                          icon={
                                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                                              <path
                                                d="M4 15l8-10 8 10H4z"
                                                stroke="#CDAF55"
                                                strokeWidth="1.7"
                                                strokeLinejoin="round"
                                              />
                                            </svg>
                                          }
                                          highlight={!!statDiffs.pickupCount}
                                          badgeLabel={
                                            statBonuses.pickupCount
                                              ? `+${statBonuses.pickupCount.toLocaleString()}`
                                              : ""
                                          }
                                        />

                                        <MiniStatCard
                                          label="TOTAL DRACS"
                                          value={playerInfo?.income ?? "â€”"}
                                          icon={
                                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                                              <circle cx="12" cy="12" r="8" stroke="#CDAF55" strokeWidth="1.7" />
                                              <path
                                                d="M8 12h8"
                                                stroke="#E5D7A2"
                                                strokeWidth="1.6"
                                                strokeLinecap="round"
                                              />
                                            </svg>
                                          }
                                          highlight={!!statDiffs.income}
                                          badgeLabel={
                                            statBonuses.income
                                              ? `+${statBonuses.income.toLocaleString()}`
                                              : ""
                                          }
                                        />
                                      </div>
                                    </div>

                                    {/* Factions Progress */}
                                    <div className="mt-2">
                                      <div className="
                                        relative
                                        bg-[#0b0a08]/90
                                        border border-amber-700/70
                                        rounded-xl
                                        shadow-[0_0_22px_rgba(0,0,0,0.85)]
                                        px-6 sm:px-8 py-5
                                      ">
                                        <div className="absolute inset-1 rounded-lg border-2 border-amber-400/70 pointer-events-none" />
                                        <div className="relative z-10">
                                          <div className="text-center mb-5">
                                            <span className="text-amber-200 text-lg font-semibold tracking-wide">
                                              Factions Progress
                                            </span>
                                          </div>
                                          <div className="space-y-5 text-xs sm:text-sm">
                                            {/* Kith of King */}
                                            <div>
                                              <div className="flex items-center justify-between mb-1">
                                                <span className="text-amber-200 flex items-center gap-2">
                                                  Kith of King
                                                  <span
                                                    className="w-2 h-2 rounded-full"
                                                    style={{ background: "#a83b3b" }}
                                                  ></span>
                                                </span>
                                                <span className="text-amber-300">
                                                  {(playerInfo?.championStanding ?? 0).toLocaleString()}
                                                </span>
                                              </div>
                                              <div className="h-2 rounded-full bg-[#2b2114] overflow-hidden">
                                                <div
                                                  className="h-full rounded-full"
                                                  style={{
                                                    width: `${Math.min(
                                                      ((playerInfo?.championStanding ?? 0) / 30000) * 100,
                                                      100
                                                    )}%`,
                                                    background: "linear-gradient(to right, #E1C172, #C7A053)"
                                                  }}
                                                ></div>
                                              </div>
                                            </div>

                                            {/* Alca Children */}
                                            <div>
                                              <div className="flex items-center justify-between mb-1">
                                                <span className="text-amber-200 flex items-center gap-2">
                                                  Alca Children
                                                  <span
                                                    className="w-2 h-2 rounded-full"
                                                    style={{ background: "#5e8b5e" }}
                                                  ></span>
                                                </span>
                                                <span className="text-amber-300">
                                                  {(playerInfo?.feyStanding ?? 0).toLocaleString()}
                                                </span>
                                              </div>
                                              <div className="h-2 rounded-full bg-[#2b2114] overflow-hidden">
                                                <div
                                                  className="h-full rounded-full"
                                                  style={{
                                                    width: `${Math.min(
                                                      ((playerInfo?.feyStanding ?? 0) / 30000) * 100,
                                                      100
                                                    )}%`,
                                                    background: "linear-gradient(to right, #E1C172, #C7A053)"
                                                  }}
                                                ></div>
                                              </div>
                                            </div>

                                            {/* The Silent Rose */}
                                            <div>
                                              <div className="flex items-center justify-between mb-1">
                                                <span className="text-amber-200 flex items-center gap-2">
                                                  The Silent Rose
                                                  <span
                                                    className="w-2 h-2 rounded-full"
                                                    style={{ background: "#4a6b9c" }}
                                                  ></span>
                                                </span>
                                                <span className="text-amber-300">
                                                  {(playerInfo?.silentRoseStanding ?? 0).toLocaleString()}
                                                </span>
                                              </div>
                                              <div className="h-2 rounded-full bg-[#2b2114] overflow-hidden">
                                                <div
                                                  className="h-full rounded-full"
                                                  style={{
                                                    width: `${Math.min(
                                                      ((playerInfo?.silentRoseStanding ?? 0) / 30000) * 100,
                                                      100
                                                    )}%`,
                                                    background: "linear-gradient(to right, #E1C172, #C7A053)"
                                                  }}
                                                ></div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                {/* Favorite Equipment */}
                                {favoriteEquipment && (
                                  <div className="mt-4">
                                    <h3 className="text-lg font-semibold text-amber-200 mb-3">
                                      Favorite Equipment (based on time & kills)
                                    </h3>

                                    <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                                      {/* Favorite Pact */}
                                      <div className="relative bg-[#0b0a08]/90 border border-amber-700/70 rounded-xl px-4 py-3 shadow-[0_0_16px_rgba(0,0,0,0.8)]">
                                        <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
                                        <div className="relative z-10 flex items-center gap-3">
                                          {favoriteEquipment.favoritePact?.pact && (
                                            <div className="w-10 h-10 flex items-center justify-center rounded-full bg-[#18140f] overflow-hidden">
                                              {PACT_ICONS[favoriteEquipment.favoritePact.pact] ? (
                                                <img
                                                  src={PACT_ICONS[favoriteEquipment.favoritePact.pact]}
                                                  alt={favoriteEquipment.favoritePact.pact}
                                                  className="w-9 h-9 object-contain"
                                                />
                                              ) : (
                                                <span className="text-xl">âœ¨</span>
                                              )}
                                            </div>
                                          )}
                                          <div className="flex-1">
                                            <div className="text-[11px] tracking-[0.16em] uppercase text-amber-300/80">
                                              Favorite Pact
                                            </div>
                                            <div className="text-sm text-amber-50 font-semibold">
                                              {favoriteEquipment.favoritePact?.pact || "â€”"}
                                            </div>
                                            {favoriteEquipment.favoritePact?.usage ? (
                                              <div className="text-[11px] text-amber-300/80 mt-0.5">
                                                {favoriteEquipment.favoritePact.usage.toLocaleString()} casts
                                              </div>
                                            ) : null}
                                          </div>
                                        </div>
                                      </div>

                                      {/* Favorite Main Weapon */}
                                      <div className="relative bg-[#0b0a08]/90 border border-amber-700/70 rounded-xl px-4 py-3 shadow-[0_0_16px_rgba(0,0,0,0.8)]">
                                        <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
                                        <div className="relative z-10">
                                          <div className="text-[11px] tracking-[0.16em] uppercase text-amber-300/80">
                                            Favorite Main Weapon
                                          </div>
                                          <div className="mt-1 text-sm text-amber-50 font-semibold break-words">
                                            {favoriteEquipment.favoriteMainWeapon?.name || "â€”"}
                                          </div>
                                          {favoriteEquipment.favoriteMainWeapon?.equipTime ? (
                                            <div className="text-[11px] text-amber-300/80 mt-0.5">
                                              {(favoriteEquipment.favoriteMainWeapon.equipTime / 3600).toFixed(1)}
                                              h equipped
                                            </div>
                                          ) : null}
                                        </div>
                                      </div>

                                      {/* Favorite Secondary Weapon */}
                                      <div className="relative bg-[#0b0a08]/90 border border-amber-700/70 rounded-xl px-4 py-3 shadow-[0_0_16px_rgba(0,0,0,0.8)]">
                                        <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
                                        <div className="relative z-10">
                                          <div className="text-[11px] tracking-[0.16em] uppercase text-amber-300/80">
                                            Favorite Secondary
                                          </div>
                                          <div className="mt-1 text-sm text-amber-50 font-semibold break-words">
                                            {favoriteEquipment.favoriteSecondaryWeapon?.name || "â€”"}
                                          </div>
                                          {favoriteEquipment.favoriteSecondaryWeapon?.equipTime ? (
                                            <div className="text-[11px] text-amber-300/80 mt-0.5">
                                              {(
                                                favoriteEquipment.favoriteSecondaryWeapon.equipTime / 3600
                                              ).toFixed(1)}
                                              h equipped
                                            </div>
                                          ) : null}
                                        </div>
                                      </div>

                                      {/* Favorite SubBoss */}
                                      <div className="relative bg-[#0b0a08]/90 border border-amber-700/70 rounded-xl px-4 py-3 shadow-[0_0_16px_rgba(0,0,0,0.8)]">
                                        <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
                                        <div className="relative z-10 flex items-center gap-3">
                                          <div className="w-10 h-10 flex items-center justify-center rounded-full bg-[#18140f]">
                                            <span className="text-lg">ðŸ‘‘</span>
                                          </div>
                                          <div className="flex-1">
                                            <div className="text-[11px] tracking-[0.16em] uppercase text-amber-300/80">
                                                Most Killed Boss
                                            </div>
                                            <div className="text-sm text-amber-50 font-semibold">
                                              {favoriteEquipment.favoriteSubBoss?.name || "â€”"}
                                            </div>
                                            {favoriteEquipment.favoriteSubBoss?.kills ? (
                                              <div className="text-[11px] text-amber-300/80 mt-0.5">
                                                {favoriteEquipment.favoriteSubBoss.kills.toLocaleString()} kills
                                              </div>
                                            ) : null}
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                )}
                              </div>
                            )}

                            {/* CONTENU ONGLET BOSS */}
                            {activeTab === "boss" && (
                              <div className="space-y-6">
                                <p className="text-sm text-amber-200/90 mb-2">
                                  Overview of SubBoss encounters based on your recorded stats.
                                </p>

                                <DataTable
                                  headers={[
                                    "SubBoss",
                                    "Faction / Biome",
                                    "Kills",
                                    "Headshots",
                                    "Executions",
                                    "Deaths"
                                  ]}
                                  data={(groupedEnemies.SUBBOSS?.enemies || []).map((e) => {
                                    const typeKey = e.type;
                                    const simpleKey = typeKey?.split("/")?.pop();
                                    const enriched = enrichedEnemies.find((x) => x.id === simpleKey);
                                    const labelMeta = SUBBOSS_CATEGORY.labels[simpleKey] || {};
                                    const icon = labelMeta.icon || enriched?.icon || null;
                                    const diff = enemyDiffs[typeKey] || {};
                                    const bonus = enemyBonuses[typeKey] || {};

                                    return [
                                      <div className="flex items-center gap-3" key={typeKey}>
                                        {icon && (
                                          <div className="w-10 h-10 rounded-lg overflow-hidden flex-shrink-0">
                                            <img
                                              src={icon}
                                              alt={getSubBossDisplayName(typeKey)}
                                              className="w-full h-full object-cover"
                                            />
                                          </div>
                                        )}
                                        <div>
                                          <div className="font-semibold text-amber-50 flex items-center gap-2">
                                            {getSubBossDisplayName(typeKey)}
                                          </div>
                                          <div className="text-[11px] text-amber-400/80">{simpleKey}</div>
                                        </div>
                                      </div>,
                                      <div className="text-sm text-amber-100">
                                        <div>{enriched?.faction || "Unknown"}</div>
                                        <div className="text-[11px] text-amber-400/80">
                                          {enriched?.biome || "â€”"}
                                        </div>
                                      </div>,
                                      <span
                                        className={diff.kills ? "text-emerald-300 font-semibold" : "text-amber-100"}
                                      >
                                        {(e.kills || 0).toLocaleString()}
                                        {bonus.kills && <DeltaBadge label={`+${bonus.kills}`} />}
                                      </span>,
                                      <span
                                        className={diff.headshots ? "text-emerald-300 font-semibold" : "text-amber-100"}
                                      >
                                        {(e.headshots || 0).toLocaleString()}
                                        {bonus.headshots && <DeltaBadge label={`+${bonus.headshots}`} />}
                                      </span>,
                                      <span
                                        className={diff.executions ? "text-emerald-300 font-semibold" : "text-amber-100"}
                                      >
                                        {(e.executions || 0).toLocaleString()}
                                        {bonus.executions && <DeltaBadge label={`+${bonus.executions}`} />}
                                      </span>,
                                      <span
                                        className={diff.deaths ? "text-red-300 font-semibold" : "text-amber-100"}
                                      >
                                        {(e.deaths || 0).toLocaleString()}
                                        {bonus.deaths && <DeltaBadge label={`+${bonus.deaths}`} />}
                                      </span>
                                    ];
                                  })}
                                  isBoss
                                />
                              </div>
                            )}

                            {/* CONTENU ONGLET ENEMIES */}
                            {activeTab === "enemies" && (
                              <div className="space-y-6">
                                {/* Overview mini stats */}
                                <div className="grid gap-4 sm:grid-cols-3">
                                  <MiniStatCard
                                    label="UNIQUE ENEMY TYPES"
                                    value={enemyOverview.uniqueTypes || 0}
                                    icon="ðŸ“–"
                                    highlight={!!statDiffs.uniqueEnemyTypes}
                                    badgeLabel={
                                      statBonuses.uniqueEnemyTypes
                                        ? `+${statBonuses.uniqueEnemyTypes}`
                                        : ""
                                    }
                                  />
                                  <MiniStatCard
                                    label="TOP FACTION (KILLS)"
                                    value={
                                      enemyOverview.topFaction
                                        ? `${enemyOverview.topFaction.faction} (${enemyOverview.topFaction.kills.toLocaleString()})`
                                        : "â€”"
                                    }
                                    icon="ðŸ³ï¸"
                                  />
                                  <MiniStatCard
                                    label="TOTAL ENEMY KILLS"
                                    value={totalStats.totalEnemyKills.toLocaleString()}
                                    icon="âš”ï¸"
                                    highlight={!!statDiffs.totalEnemyKills}
                                    badgeLabel={
                                      statBonuses.totalEnemyKills
                                        ? `+${statBonuses.totalEnemyKills.toLocaleString()}`
                                        : ""
                                    }
                                  />
                                </div>

                                {/* Enemy Index */}
                                <AccordionSection
                                  title="Enemy Index"
                                  subtitle="All enemies"
                                  isOpen={openEnemyPanel === "index"}
                                  onToggle={() =>
                                    setOpenEnemyPanel(openEnemyPanel === "index" ? "" : "index")
                                  }
                                >
                                  <DataTable
                                    headers={[
                                      { label: "Enemy", key: "enemy" },
                                      { label: "Faction", key: "faction" },
                                      { label: "Biome", key: "biome" },
                                      { label: "Tags", key: "tags" },
                                      { label: "Kills", key: "kills" },
                                      { label: "Headshots", key: "headshots" },
                                      { label: "Executions", key: "executions" }
                                    ]}
                                    data={sortedEnrichedEnemies
                                      .filter(
                                        (e) =>
                                          !COMPENDIUM_EXCLUDED.has(
                                            (e.baseId || e.id || "").replace(/Avatar$/, "")
                                          )
                                      )
                                      .map((e) => {
                                        const diff = enemyDiffs[e.type] || {};
                                        const bonus = enemyBonuses[e.type] || {};
                                        const tags = [];
                                        if (e.category && e.category !== "Unknown") tags.push(e.category);
                                        if (e.isSpectre) tags.push("Spectre");
                                        if (e.eventTag) tags.push(e.eventTag);
                                        const isSubBoss = SUBBOSS_CATEGORY.enemies.includes(e.id);

                                        return [
                                          <div className="flex items-center gap-3" key={e.id}>
                                            {e.icon && (
                                              <div className="w-9 h-9 rounded-lg overflow-hidden flex-shrink-0">
                                                <img
                                                  src={e.icon}
                                                  alt={e.name}
                                                  className="w-full h-full object-cover"
                                                />
                                              </div>
                                            )}
                                            <div>
                                              <div className="font-semibold text-amber-50 flex items-center gap-2">
                                                {e.name}
                                                {isSubBoss && (
                                                  <span className="text-[10px] px-1.5 py-0.5 rounded-full bg-amber-900/60 border border-amber-600/70 text-amber-200">
                                                    SubBoss
                                                  </span>
                                                )}
                                               
                                              </div>
                                              <div className="text-[11px] text-amber-400/80">{e.baseId}</div>
                                            </div>
                                          </div>,
                                          e.faction || "Unknown",
                                          e.biome || "â€”",
                                          tags.length ? tags.join(", ") : "â€”",
                                          <span
                                            className={
                                              diff.kills
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(e.kills || 0).toLocaleString()}
                                            {bonus.kills && (
                                              <DeltaBadge label={`+${bonus.kills.toLocaleString()}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.headshots
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(e.headshots || 0).toLocaleString()}
                                            {bonus.headshots && (
                                              <DeltaBadge
                                                label={`+${bonus.headshots.toLocaleString()}`}
                                              />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.executions
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(e.executions || 0).toLocaleString()}
                                            {bonus.executions && (
                                              <DeltaBadge
                                                label={`+${bonus.executions.toLocaleString()}`}
                                              />
                                            )}
                                          </span>
                                        ];
                                      })}
                                    sortConfig={enemySort}
                                    onSortChange={handleEnemySortChange}
                                  />
                                </AccordionSection>

                                {/* Faction Index */}
                                <AccordionSection
                                  title="Faction Index"
                                  subtitle="Enemy types per faction."
                                  isOpen={openEnemyPanel === "faction"}
                                  onToggle={() =>
                                    setOpenEnemyPanel(openEnemyPanel === "faction" ? "" : "faction")
                                  }
                                >
                                  <DataTable
                                    headers={["Faction", "Unique enemy types", "Total kills"]}
                                    data={factionGroups.map(([faction, group]) => [
                                      faction,
                                      group.enemies.length,
                                      group.totalKills.toLocaleString()
                                    ])}
                                  />
                                </AccordionSection>
                              </div>
                            )}

                            {/* CONTENU ONGLET WEAPONS */}
                            {activeTab === "weapons" && (
                              <div className="space-y-8">
                                <p className="text-sm text-amber-200/90">
                                  Weapon stats are based on your usage time, kills, headshots and XP earned. Green
                                  values indicate recent progress since the last update.
                                </p>

                                {/* Main Weapons */}
                                <Card
                                  id="weapons-main"
                                  title="Main Weapons"
                                  defaultExpanded={true}
                                  className="mb-4"
                                >
                                  {(() => {
                                    const rows = [];
                                    Object.entries(groupedWeapons.main).forEach(([groupName, list]) => {
                                      list.forEach((w) => {
                                        const display = getWeaponDisplayData(w.type);
                                        const diff = weaponDiffs[w.type] || {};
                                        const bonus = weaponBonuses[w.type] || {};
                                        rows.push([
                                          <div className="flex items-center gap-3" key={w.type}>
                                            {display.icon && (
                                              <div className="w-9 h-9 rounded-lg overflow-hidden flex-shrink-0">
                                                {typeof display.icon === "string" &&
                                                display.icon.startsWith("http") ? (
                                                  <img
                                                    src={display.icon}
                                                    alt={display.name}
                                                    className="w-full h-full object-contain"
                                                  />
                                                ) : (
                                                  <span className="text-xl">{display.icon}</span>
                                                )}
                                              </div>
                                            )}
                                            <div>
                                              <div className="font-semibold text-amber-50">
                                                {display.name}
                                              </div>
                                              <div className="text-[11px] text-amber-400/80">
                                                {groupName}
                                              </div>
                                            </div>
                                          </div>,
                                          display.group,
                                          "Main",
                                          <span
                                            className={
                                              diff.kills
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.kills || 0).toLocaleString()}
                                            {bonus.kills && (
                                              <DeltaBadge label={`+${bonus.kills.toLocaleString()}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.headshots
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.headshots || 0).toLocaleString()}
                                            {bonus.headshots && (
                                              <DeltaBadge
                                                label={`+${bonus.headshots.toLocaleString()}`}
                                              />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.assists
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.assists || 0).toLocaleString()}
                                            {bonus.assists && (
                                              <DeltaBadge label={`+${bonus.assists.toLocaleString()}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.xp
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {formatXP(w.xp || 0)}
                                            {bonus.xp && (
                                              <DeltaBadge label={`+${formatXP(bonus.xp)}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.equipTime
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {((w.equipTime || 0) / 3600).toFixed(1)}h
                                            {bonus.equipTime && (
                                              <DeltaBadge
                                                label={`+${(bonus.equipTime / 3600).toFixed(1)}h`}
                                              />
                                            )}
                                          </span>
                                        ]);
                                      });
                                    });
                                    return (
                                      <DataTable
                                        headers={[
                                          "Weapon",
                                          "Type",
                                          "Slot",
                                          "Kills",
                                          "Headshots",
                                          "Assists",
                                          "XP",
                                          "Time equipped"
                                        ]}
                                        data={rows}
                                      />
                                    );
                                  })()}
                                </Card>

                                {/* Secondary Weapons */}
                                <Card id="weapons-secondary" title="Secondary Weapons" defaultExpanded={true}>
                                  {(() => {
                                    const rows = [];
                                    Object.entries(groupedWeapons.secondary).forEach(([groupName, list]) => {
                                      list.forEach((w) => {
                                        const display = getWeaponDisplayData(w.type);
                                        const diff = weaponDiffs[w.type] || {};
                                        const bonus = weaponBonuses[w.type] || {};
                                        rows.push([
                                          <div className="flex items-center gap-3" key={w.type}>
                                            {display.icon && (
                                              <div className="w-9 h-9 rounded-lg overflow-hidden flex-shrink-0">
                                                {typeof display.icon === "string" &&
                                                display.icon.startsWith("http") ? (
                                                  <img
                                                    src={display.icon}
                                                    alt={display.name}
                                                    className="w-full h-full object-contain"
                                                  />
                                                ) : (
                                                  <span className="text-xl">{display.icon}</span>
                                                )}
                                              </div>
                                            )}
                                            <div>
                                              <div className="font-semibold text-amber-50">
                                                {display.name}
                                              </div>
                                              <div className="text-[11px] text-amber-400/80">
                                                {groupName}
                                              </div>
                                            </div>
                                          </div>,
                                          display.group,
                                          "Secondary",
                                          <span
                                            className={
                                              diff.kills
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.kills || 0).toLocaleString()}
                                            {bonus.kills && (
                                              <DeltaBadge label={`+${bonus.kills.toLocaleString()}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.headshots
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.headshots || 0).toLocaleString()}
                                            {bonus.headshots && (
                                              <DeltaBadge
                                                label={`+${bonus.headshots.toLocaleString()}`}
                                              />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.assists
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {(w.assists || 0).toLocaleString()}
                                            {bonus.assists && (
                                              <DeltaBadge label={`+${bonus.assists.toLocaleString()}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.xp
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {formatXP(w.xp || 0)}
                                            {bonus.xp && (
                                              <DeltaBadge label={`+${formatXP(bonus.xp)}`} />
                                            )}
                                          </span>,
                                          <span
                                            className={
                                              diff.equipTime
                                                ? "text-emerald-300 font-semibold"
                                                : "text-amber-100"
                                            }
                                          >
                                            {((w.equipTime || 0) / 3600).toFixed(1)}h
                                            {bonus.equipTime && (
                                              <DeltaBadge
                                                label={`+${(bonus.equipTime / 3600).toFixed(1)}h`}
                                              />
                                            )}
                                          </span>
                                        ]);
                                      });
                                    });
                                    return (
                                      <DataTable
                                        headers={[
                                          "Weapon",
                                          "Type",
                                          "Slot",
                                          "Kills",
                                          "Headshots",
                                          "Assists",
                                          "XP",
                                          "Time equipped"
                                        ]}
                                        data={rows}
                                      />
                                    );
                                  })()}
                                </Card>
                              </div>
                            )}

                            {/* CONTENU ONGLET ABILITIES */}
                            {activeTab === "abilities" && (
                              <div className="space-y-6">
                                <p className="text-sm text-amber-200/90">
                                  Abilities are grouped by Pact. Usage counts are based on how many times each
                                  ability has been cast.
                                </p>

                                {GROUP_ORDER.map((groupName) => {
                                  const list = groupedAbilities[groupName];
                                  if (!list || !list.length) return null;
                                  return (
                                    <div
                                      key={groupName}
                                      className="relative bg-[#0b0a08]/90 border border-amber-700/70 rounded-xl px-5 py-4 shadow-[0_0_18px_rgba(0,0,0,0.8)]"
                                    >
                                      <div className="absolute inset-1 rounded-lg border border-amber-400/70 pointer-events-none" />
                                      <div className="relative z-10">
                                        <div className="flex items-center gap-3 mb-3">
                                          {PACT_ICONS[groupName] && (
                                            <div className="w-9 h-9 rounded-full overflow-hidden bg-[#18140f] flex items-center justify-center">
                                              <img
                                                src={PACT_ICONS[groupName]}
                                                alt={groupName}
                                                className="w-8 h-8 object-contain"
                                              />
                                            </div>
                                          )}
                                          <div>
                                            <div className="text-sm font-semibold text-amber-100">
                                              {groupName}
                                            </div>
                                            <div className="text-[11px] text-amber-400/80">
                                              {list.length} abilities
                                            </div>
                                          </div>
                                        </div>

                                        <div className="grid gap-3 sm:grid-cols-2 md:grid-cols-3">
                                          {list.map((ab) => (
                                            <div
                                              key={ab.name}
                                              className="flex items-center gap-3 bg-[#12100d]/90 rounded-lg px-3 py-2 border border-amber-800/60"
                                            >
                                              <div className="w-8 h-8 rounded-lg bg-[#1b160f] flex items-center justify-center overflow-hidden flex-shrink-0">
                                                {typeof ab.icon === "string" && ab.icon.startsWith("http") ? (
                                                  <img
                                                    src={ab.icon}
                                                    alt={ab.name}
                                                    className="w-7 h-7 object-contain"
                                                  />
                                                ) : (
                                                  <span className="text-lg">{ab.icon}</span>
                                                )}
                                              </div>
                                              <div className="flex-1">
                                                <div className="text-sm text-amber-50 font-semibold">
                                                  {ab.name}
                                                </div>
                                                <div className="text-[11px] text-amber-300/80">
                                                  {ab.used.toLocaleString()} casts
                                                </div>
                                              </div>
                                            </div>
                                          ))}
                                        </div>
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            )}
                          </section>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>
              </div>
            </div>
          </main>

          {/* Footer */}
          <footer className="relative z-40 border-t border-amber-900/20 bg-[#0a0a08]/50 py-6 mt-12">
            <div className="max-w-7xl mx-auto px-4 text-center text-amber-400/60 text-sm">
              <p>Soulframe Data Tracker â€¢ DonnÃ©es rÃ©cupÃ©rÃ©es depuis l'API officielle</p>
              <div className="text-center text-amber-500/40 text-xs">
                <p className="mb-2">
                  Soulframeâ„¢ est une marque dÃ©posÃ©e de <strong>Digital Extremes Ltd.</strong><br />
                  Ce site est un outil de suivi crÃ©Ã© par des fans et n'est pas affiliÃ© Ã  Digital Extremes.<br />
                  Tous les droits des assets multimÃ©dias reviennent Ã  leurs propriÃ©taires respectifs.
                </p>
              </div>
            </div>
          </footer>

          {/* Voile de transition */}
          {isTransitioning && (
            <div className="transition-veil" aria-hidden="true">
              <div className="transition-logo">
                <img
                  src="https://raw.githubusercontent.com/generalshark/app-soulframe-v1/refs/heads/main/public/logoV1big.png"
                  alt=""
                />
              </div>
            </div>
          )}
        </div>
      );
    };

    // Bootstrap React
    const rootElement = document.getElementById("root");
    if (rootElement) {
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    }
  </script>
</body>
</html>